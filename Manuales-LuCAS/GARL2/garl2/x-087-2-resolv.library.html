<HTML
><HEAD
><TITLE
>La biblioteca de resolución</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.76b+
"><LINK
REL="HOME"
TITLE="Guía de Administración de Redes con Linux"
HREF="index.html"><LINK
REL="UP"
TITLE="El servicio de nombres y su configuración"
HREF="x-087-2-resolv.html"><LINK
REL="PREVIOUS"
TITLE="El servicio de nombres y su configuración"
HREF="x-087-2-resolv.html"><LINK
REL="NEXT"
TITLE="Cómo funciona el DNS"
HREF="x-087-2-resolv.howdnsworks.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="publicacoes.css"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Guía de Administración de Redes con Linux</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x-087-2-resolv.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Capítulo 6. El servicio de nombres y su configuración</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x-087-2-resolv.howdnsworks.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="X-087-2-RESOLV.LIBRARY">6.1. La biblioteca de resolución</H1
><P
>Cuando hablamos del <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>sistema de resolución</I
></SPAN
>, no nos referiremos a
una aplicación en particular, sino a la <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>biblioteca de resolución</I
></SPAN
>:
un conjunto de funciones que pueden encontrarse en las bibliotecas
estándar del lenguaje C. Las rutinas principales son <TT
CLASS="FUNCTION"
>gethostbyname(2)</TT
>
y <TT
CLASS="FUNCTION"
>gethostbyaddr(2)</TT
>, que buscan la dirección IP de una máquina a
partir del nombre y viceversa. Es posible configurarlas para que simplemente miren en el 
fichero <TT
CLASS="FILENAME"
>hosts</TT
> local (o remoto, si se usa NIS).</P
><P
>Las funciones del sistema de resolución leen ficheros de configuración
cuando son llamadas. Desde estos ficheros, determinan qué bases de
datos hay que interrogar, en qué orden y otros detalles relevantes. En
la antigua biblioteca libc de GNU/Linux, se utilizaba el fichero
<TT
CLASS="FILENAME"
>/etc/host.conf</TT
> como fichero maestro, pero en la
versión 2 de las bibliotecas, la glibc, se utiliza el fichero
<TT
CLASS="FILENAME"
>/etc/nsswitch.conf</TT
>. Vamos a describir ambas
formas, puesto que son muy usuales.</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="X-087-2-RESOLV.HOST-CONF">6.1.1. El fichero host.conf</H2
><P
>El fichero <TT
CLASS="FILENAME"
>host.conf</TT
> se encuentra en
el directorio <TT
CLASS="FILENAME"
>/etc</TT
> e indica al sistema de resolución qué
servicios debe usar y en qué orden.</P
><P
>Las opciones del fichero <TT
CLASS="FILENAME"
>host.conf</TT
> deben estar en líneas
distintas. Los campos deben separarse por blancos (espacios o tabuladores). 
Un símbolo almohadillado (<SPAN
CLASS="SYSTEMITEM"
>#</SPAN
>) supone desde
ese punto hasta el final de la línea un comentario del fichero. Las opciones 
disponibles son las siguientes:

<P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>order</SPAN
></DT
><DD
><P
>&#13;Determina el orden en el que los servicios de resolución se usan. Opciones válidas
son <SPAN
CLASS="SYSTEMITEM"
>bind</SPAN
> para usar el servidor de nombres, 
<TT
CLASS="FILENAME"
>/etc/hosts</TT
> para buscar en <TT
CLASS="FILENAME"
>/etc/hosts</TT
> y 
<SPAN
CLASS="SYSTEMITEM"
>nis</SPAN
> para buscar con NIS. Puede especificarse
cualquiera de las anteriores, y el orden de aparición determina qué servicio se 
prueba en primer lugar para intentar resolver el nombre.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>multi</SPAN
></DT
><DD
><P
>Va con las opciones <SPAN
CLASS="SYSTEMITEM"
>on</SPAN
> u
<SPAN
CLASS="SYSTEMITEM"
>off</SPAN
>. Determina si
una máquina del fichero <TT
CLASS="FILENAME"
>/etc/hosts</TT
> puede tener distintas
direcciones IP o no. Esta opción no tiene efecto en peticiones via NIS
o DNS.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>nospoof</SPAN
></DT
><DD
><P
>&#13;


Como se explicó en la sección <A
HREF="x-087-2-resolv.howdnsworks.html#X-087-2-RESOLV.DNS.IN-ADDR"
>Sección 6.2.4</A
>, &rdquo; DNS
le permite encontrar un nombre de máquina perteneciente a una dirección IP utilizando el dominio <SPAN
CLASS="SYSTEMITEM"
>in-addr.arpa</SPAN
>. Los intentos de los
servidores de nombres de proporcionar un nombre falso se conocen en
inglés como <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>spoofing</I
></SPAN
><A
NAME="AEN4708"
HREF="#FTN.AEN4708"
>[1]</A
>. Para evitar esto, el sistema puede configurarse para comprobar
si las direcciones IP originales están de hecho asociadas con el
nombre obtenido. Si no, el nombre será rechazado y se retornará un
error. Esta opción se activa poniendo <SPAN
CLASS="SYSTEMITEM"
>nospoof on</SPAN
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>alert</SPAN
></DT
><DD
><P
>Esta opción puede tomar el valor <SPAN
CLASS="SYSTEMITEM"
>on</SPAN
> u 
<SPAN
CLASS="SYSTEMITEM"
>off</SPAN
> como argumentos. Si se
activa, cualquier intento de <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>spoof</I
></SPAN
> será anotado
con un mensaje enviado al sistema de registros
<B
CLASS="COMMAND"
>syslog</B
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>trim</SPAN
></DT
><DD
><P
>Esta opción lleva un nombre de dominio como argumento, que se quitará a los 
nombres antes de buscar su dirección. Es útil para las entradas del fichero 
<TT
CLASS="FILENAME"
>hosts</TT
>, que podrán así ir solos los nombres de máquinas, 
sin el dominio. Cuando se busque una máquina con el nombre de dominio local 
éste será eliminado, haciendo que la búsqueda en el fichero 
<TT
CLASS="FILENAME"
>/etc/hosts</TT
> tenga éxito. El dominio que añada debe 
terminar en un punto (.) (por ejemplo, <TT
CLASS="LITERAL"
>linux.org.au.</TT
>).</P
><P
>Las opciones de <SPAN
CLASS="SYSTEMITEM"
>trim</SPAN
> se van
acumulando; podemos considerar nuestra máquina como local de
diversos dominios.</P
></DD
></DL
></DIV
><P></P
><P
>Veamos un fichero de ejemplo para <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> en
<A
HREF="x-087-2-resolv.library.html#X-087-2-DNS-HOST.CONF.FILE"
>Ejemplo 6-1</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-DNS-HOST.CONF.FILE"><P
><B
>Ejemplo 6-1. Ejemplo de fichero host.conf</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    # /etc/host.conf
    # Tenemos servidor de nombres, pero no NIS (de momento)
    order   bind hosts
    # Permitir direcciones múltiples
    multi   on
    # Contra los nombres falsos
    nospoof on
    # Dominio local por defecto (no necesario).
    trim    vbrew.com.</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="X-087-2-RESOLV.ENVIRON">6.1.1.1. Variables de entorno</H3
><P
>Existen algunas variables de entorno que establecen opciones que
tienen más prioridad sobre las puestas en el fichero
<TT
CLASS="FILENAME"
>host.conf</TT
>. Éstas son:

<P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>RESOLV_HOST_CONF</SPAN
></DT
><DD
><P
>&#13;Especifica un fichero alternativo a <TT
CLASS="FILENAME"
>/etc/host.conf</TT
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>RESOLV_SERV_ORDER</SPAN
></DT
><DD
><P
>&#13;Establece la opción equivalente a la orden <SPAN
CLASS="SYSTEMITEM"
>order</SPAN
> del
fichero anterior. Los servicios pueden ser <SPAN
CLASS="SYSTEMITEM"
>hosts</SPAN
>,
<SPAN
CLASS="SYSTEMITEM"
>bind</SPAN
> y/o <SPAN
CLASS="SYSTEMITEM"
>nis</SPAN
>, separados por comas, espacios, puntos
o puntos y coma.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>RESOLV_SPOOF_CHECK</SPAN
></DT
><DD
><P
>&#13;Determina la política seguida frente a los nombres
falsos. Estará completamente desactivada con la opción
<SPAN
CLASS="SYSTEMITEM"
>off</SPAN
>. Con las opciones 
<SPAN
CLASS="SYSTEMITEM"
>warn</SPAN
> y 
<SPAN
CLASS="SYSTEMITEM"
>warn off</SPAN
> se realizarán comprobaciones contra los 
nombres falsos, pero en el primer caso se mandarán los avisos al registro. Un valor 
<SPAN
CLASS="SYSTEMITEM"
>*</SPAN
> activa las comprobaciones contra nombres falsos, 
pero las anotaciones en el registro se dejan como diga el fichero 
<TT
CLASS="FILENAME"
>host.conf</TT
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>RESOLV_MULTI</SPAN
></DT
><DD
><P
> 
El valor <SPAN
CLASS="SYSTEMITEM"
>on</SPAN
> activa la opción
``multi'', y el valor <SPAN
CLASS="SYSTEMITEM"
>off</SPAN
> la desactiva.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>RESOLV_OVERRIDE_TRIM_DOMAINS</SPAN
></DT
><DD
><P
> 
Esta variable lleva una lista de dominios por defecto, similar
a la puesta en el fichero <TT
CLASS="FILENAME"
>host.conf</TT
> con la opción
<SPAN
CLASS="SYSTEMITEM"
>trim</SPAN
>. </P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>RESOLV_ADD_TRIM_DOMAINS</SPAN
></DT
><DD
><P
>&#13;Esta variable lleva una lista de dominios por defecto que se
<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>añade</I
></SPAN
> a las que se dan en el fichero
<TT
CLASS="FILENAME"
>host.conf</TT
>.</P
></DD
></DL
></DIV
><P></P
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="X-087-2-RESOLV.NSSWITCH-CONF">6.1.2. El fichero nsswitch.conf</H2
><P
>La versión 2 de la biblioteca estándar de funciones de GNU incluye
un fichero más flexible para sustituir a
<TT
CLASS="FILENAME"
>host.conf</TT
>. El concepto de servicio de nombres se
ha extendido para incluir una variedad de diferentes tipos de
información. Las opciones para seleccionar las bases de datos a las
que interrogar se han introducido todas en un fichero, que se llama
<TT
CLASS="FILENAME"
>nsswitch.conf</TT
>.</P
><P
>El fichero <TT
CLASS="FILENAME"
>nsswitch.conf</TT
> permite al administrador
de sistemas configurar una amplia variedad de diferentes bases de
datos. Limitaremos nuestra discusión a opciones que se refieran a la
resolución de nombres de máquina y direcciones IP. Se puede encontrar
fácilmente mucha más información para aprovechar el resto de las
características de este fichero, sin más que leer la documentación de
la biblioteca estándar GNU.</P
><P
>Las opciones del fichero <TT
CLASS="FILENAME"
>nsswitch.conf</TT
> deben
estar en líneas diferentes. Los campos se separan por blancos
(espacios o tabuladores). Un signo de almohadillado
(<SPAN
CLASS="SYSTEMITEM"
>#</SPAN
>) introducirá un comentario
para todo el resto de esa línea. Cada línea describe un servicio en
particular; la resolución de nombres es uno de ellos. El primer campo
de cada línea es el nombre de la base de datos, finalizado en el signo
de dos puntos. La base de datos relacionada con la resolución es
<SPAN
CLASS="SYSTEMITEM"
>hosts</SPAN
>. Una base de datos
relacionada es <SPAN
CLASS="SYSTEMITEM"
>networks</SPAN
>, que
se usa para convertir nombres en direcciones de redes. El resto de
cada línea lleva opciones que determinan cómo se hacen las búsquedas
de los elementos de la base de datos.</P
><P
>Las opciones posibles son:

<P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>dns</SPAN
></DT
><DD
><P
>&#13;Indica que se usa el DNS para resolver la dirección. Esto solo sirve
para resolución de nodos, no de redes. Para ello se mira primero el
fichero <TT
CLASS="FILENAME"
>/etc/resolv.conf</TT
>, que veremos después.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>files</SPAN
></DT
><DD
><P
>Hace la búsqueda en un fichero local. Es decir, en
<TT
CLASS="FILENAME"
>/etc/hosts</TT
> para los nodos, y en
<TT
CLASS="FILENAME"
>/etc/network</TT
> para las redes.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>nis</SPAN
> o 
<SPAN
CLASS="SYSTEMITEM"
>nisplus</SPAN
></DT
><DD
><P
>&#13;Usará el sistema NIS (sistema de información en red) para resolver
nodos o redes. NIS y NIS+ se discuten en detalle en <A
HREF="x-087-2-nis.html"
>Capítulo 13</A
>.</P
></DD
></DL
></DIV
><P></P
><P
>El orden en el que los servicios estén listados es el orden en el que
serán interrogados para buscar un nombre. Es decir, los servicios son
interrogados leyéndolos de izquierda a derecha, hasta encontrar la respuesta.</P
><P
>Un ejemplo de fichero <TT
CLASS="FILENAME"
>nsswitch.conf</TT
> lo tenemos en
<A
HREF="x-087-2-resolv.library.html#X-087-2-DNS-NSSWITCH.CONF.FILE"
>Ejemplo 6-2</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-DNS-NSSWITCH.CONF.FILE"><P
><B
>Ejemplo 6-2. Ejemplo de fichero nsswitch.conf</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    # /etc/nsswitch.conf
    #
    # Ejemplo de configuracion del nsswitch de GNU.
    # En el paquete `libc6-doc' se documentan estos ficheros.
    
    hosts:          dns files
    networks:       files
    </PRE
></TD
></TR
></TABLE
></DIV
><P
>Este ejemplo hace que el sistema busque los nodos, primero en el DNS y
después en <TT
CLASS="FILENAME"
>/etc/hosts</TT
>, si no se encuentra. En
cambio las redes se buscan exclusivamente en
<TT
CLASS="FILENAME"
>/etc/networks</TT
>.</P
><P
> Podemos controlar el comportamiento más
precisamente, usando &ldquo;items de acción&rdquo; que describen qué
hacer tras el último intento de búsquedas. Los items de acción
aparecen entre los servicios, y se encierran entre corchetes,
<SPAN
CLASS="SYSTEMITEM"
>[</SPAN
>. La sintaxis general es:

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    [ [!] <TT
CLASS="REPLACEABLE"
><I
>estado</I
></TT
> = <TT
CLASS="REPLACEABLE"
><I
>acción</I
></TT
> ... ]</PRE
></TD
></TR
></TABLE
>&#13;</P
><P
>Hay dos posibles acciones:

<P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>return</SPAN
></DT
><DD
><P
>Hace que el control retorne al programa que hizo la petición de
resolución. Si la búsqueda tuvo éxito, retornará los detalles. Si no,
retornará un cero.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>continue</SPAN
></DT
><DD
><P
>El sistema seguirá buscando a través del siguiente servicio de la lista.</P
></DD
></DL
></DIV
><P>

El carácter opcional (!) especifica que el valor de estado debe
considerarse invertido antes de comprobarlo, es decir, es un
&ldquo;not.&rdquo;</P
><P
>Los valores de estado posible son:

<P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
><SPAN
CLASS="SYSTEMITEM"
>success</SPAN
></DT
><DD
><P
>La petición se encontró sin errores. La acción por defecto aquí es
<SPAN
CLASS="SYSTEMITEM"
>return</SPAN
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>notfound</SPAN
></DT
><DD
><P
>No hubo error en la búsqueda, pero no se encontró el nodo o la red. La
acción predeterminada aquí es <SPAN
CLASS="SYSTEMITEM"
>continue</SPAN
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>unavail</SPAN
></DT
><DD
><P
>El servicio solicitado no está disponible. Por ejemplo, que el fichero
<TT
CLASS="FILENAME"
>/etc/hosts</TT
> no esté en su sitio, o que el servidor
DNS o NIS requeridos no respondan. La acción predeterminada es 
<SPAN
CLASS="SYSTEMITEM"
>continue</SPAN
>.</P
></DD
><DT
><SPAN
CLASS="SYSTEMITEM"
>tryagain</SPAN
></DT
><DD
><P
>Significa que el servicio estaba no disponible temporalmente. Por
ejemplo, que el fichero <TT
CLASS="FILENAME"
>hosts</TT
> esté bloqueado por
otro proceso, o que el DNS esté muy cargado. La acción predeterminada
para este estado es <SPAN
CLASS="SYSTEMITEM"
>continue</SPAN
>.</P
></DD
></DL
></DIV
><P></P
><P
>Un ejemplo de uso de todo esto se muestra en
<A
HREF="x-087-2-resolv.library.html#X-087-2-DNS-NSSWITCH.CONF.FILE.EXTENDED"
>Ejemplo 6-3</A
>.</P
><DIV
CLASS="EXAMPLE"
><A
NAME="X-087-2-DNS-NSSWITCH.CONF.FILE.EXTENDED"><P
><B
>Ejemplo 6-3. Ejemplo de nsswitch.conf con acciones</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    # /etc/nsswitch.conf
    #
    # Ejemplo de configuracion del nsswitch de GNU.
    # En el paquete `libc6-doc' se documentan estos ficheros.
    
    hosts:          dns [!UNAVAIL=return] files
    networks:       files
    </PRE
></TD
></TR
></TABLE
></DIV
><P
>Este ejemplo intentará resolver los nodos usando el DNS. Si se
devuelve un error que no sea UNAVAIL, el sistema devolverá lo que ha
encontrado. En otro caso intentará buscarlo en
<TT
CLASS="FILENAME"
>/etc/hosts</TT
>. Esto significa que este fichero solo
se usará en caso de que el DNS no funcione bien.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="X-087-2-RESOLV.RESOLV">6.1.3. Configuración del fichero resolv.conf</H2
><P
>Cuando se configura la biblioteca de resolución para utilizar los
servicios de BIND, tiene que indicarse también qué servidores
utilizar. El fichero <TT
CLASS="FILENAME"
>resolv.conf</TT
> contiene una lista de
servidores, que si está vacía hará considerar al sistema que el
servidor está en su máquina.</P
><P
>Si ejecuta un servidor de nombres en su máquina local, tendrá que
configurarlo por separado, como se explicará después. Si se encuentra
en una red local y puede usar un servidor de nombres existente,
mejor. Si estamos conectados a Internet por módem, lo habitual es
especificar en <TT
CLASS="FILENAME"
>resolv.conf</TT
> el servidor de nombres
que nos diga nuestro proveedor de servicios.</P
><P
>La opción más importante del fichero <TT
CLASS="FILENAME"
>resolv.conf</TT
> es
<SPAN
CLASS="SYSTEMITEM"
>nameserver</SPAN
>, que tiene la
dirección IP del servidor de
nombres a usar. Si especifican varios servidores poniendo varias líneas
<SPAN
CLASS="SYSTEMITEM"
>nameserver</SPAN
>, se intentarán usar
en el orden dado; por lo que
debería poner en primer lugar el servidor de nombres más rápido o
cercano. Actualmente, puede ponerse un máximo de tres servidores
distintos. Si no se pone ninguno, intentará buscar un servidor de
nombres en la máquina local.</P
><P
>&#13;
Otras dos opciones, <SPAN
CLASS="SYSTEMITEM"
>domain</SPAN
> y
<SPAN
CLASS="SYSTEMITEM"
>search</SPAN
>, nos permiten usar
nombres cortos (sin dominio) para máquinas que estén en nuestro
dominio. Normalmente, para conectarnos a una máquina de la misma red,
no queremos poner el dominio completo, sino su nombre. Por ejemplo,
<SPAN
CLASS="SYSTEMITEM"
>gauss</SPAN
> en lugar de
<SPAN
CLASS="SYSTEMITEM"
>gauss.mathematics.groucho.edu</SPAN
>.</P
><P
>Para esto sirve la palabra <SPAN
CLASS="SYSTEMITEM"
>domain</SPAN
>. 
Nos permite especificar un dominio predeterminado que se añade a las
peticiones cuando su búsqueda inicial falla. Por ejemplo, al buscar
<SPAN
CLASS="SYSTEMITEM"
>gauss</SPAN
> y fallar el servidor
de nombres buscándolo en Internet, le añade automáticamente su dominio
predeterminado y ya sí puede resolverlo.</P
><P
>Esto está bien, pensaremos, pero tan pronto como nos refiramos a una
máquina que esté fuera del Departamento de Matemáticas, tendremos que
volver a teclear el dominio completo. A lo mejor queremos teclear solo
<SPAN
CLASS="SYSTEMITEM"
>quark.physics</SPAN
> para referirnos
a una máquina del Departamento de Físicas.</P
><P
>Para esto podemos usar la <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>lista de búsqueda</I
></SPAN
>, que
puede especificarse con la opción
<SPAN
CLASS="SYSTEMITEM"
>search</SPAN
>. En esta lista se
especifica una lista de dominios donde resolver nombres cortos. Los
elementos de la lista deben especificarse separándolos por espacios o
tabuladores.</P
><P
>Las opciones <SPAN
CLASS="SYSTEMITEM"
>search</SPAN
> y
<SPAN
CLASS="SYSTEMITEM"
>domain</SPAN
> son mutuamente
excluyentes y no pueden aparecer más de una vez. Si ninguna de las dos
se pone, el sistema intentará asignar a los nombres cortos el dominio
de la máquina local, que averiguará usando la llamada al sistema
<TT
CLASS="FUNCTION"
>getdomainname(2)</TT
>. Si el nodo local no tiene
dominio, se asumirá que el dominio predeterminado es el raíz.</P
><P
>Si decidimos poner una opción <SPAN
CLASS="SYSTEMITEM"
>search</SPAN
>
en el fichero <TT
CLASS="FILENAME"
>resolv.conf</TT
>, habrá que ser
cuidadosos con los dominios que añadimos a la lista. Las bibliotecas de
resolución anteriores a BIND 4.9 solían construir una lista de
búsqueda predeterminada para el dominio cuando no se proporciona otra
lista. Esta lista predeterminada se hacía con el dominio del nodo, más
todos los dominios padre hasta llegar a la raíz. Esto daba lugar a
búsquedas innecesarias a los servidores de nombres externos.</P
><P
>Asumamos que estamos en la Cervecera Virtual y queremos conectarnos al
sistema <SPAN
CLASS="SYSTEMITEM"
>foot.groucho.edu</SPAN
>. Por un error
tecleamos el nombre <SPAN
CLASS="SYSTEMITEM"
>foo</SPAN
>, que
no existe. El servidor de la universidad nos responderá que no existe
el nodo. Con la búsqueda antigua, intentará buscar ese nombre en los
dominios <SPAN
CLASS="SYSTEMITEM"
>vbrew.com</SPAN
> y
<SPAN
CLASS="SYSTEMITEM"
>com</SPAN
>. Este último es
problemático porque causa una búsqueda innecesaria y además podría
existir. Al final nos habremos intentado conectar a una máquina
totalmente ajena.</P
><P
>En algunos casos, esto es un potencial problema de seguridad. De hecho
las listas de búsqueda deben limitarse a dominios de la organización
local o algo similar. La lista en el Departamento de Matemáticas debe
limitarse a los dominios
<SPAN
CLASS="SYSTEMITEM"
>maths.groucho.edu</SPAN
> y
<SPAN
CLASS="SYSTEMITEM"
>groucho.edu</SPAN
>.</P
><P
>Como lo anterior puede resultar confuso, sea el siguiente ejemplo de
fichero <TT
CLASS="FILENAME"
>resolv.conf</TT
> para la Cervecera Virtual:

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    # /etc/resolv.conf
    # Nuestro dominio
    domain         vbrew.com
    #
    # Nuestro servidor principal va a ser vlager:
    name server     172.16.1.1</PRE
></TD
></TR
></TABLE
></P
><P
>Cuando se trate de traducir el nombre
<SPAN
CLASS="SYSTEMITEM"
>vale</SPAN
>, el sistema empezará
por buscar directamente <SPAN
CLASS="SYSTEMITEM"
>vale</SPAN
>
y si falla, probará con
<SPAN
CLASS="SYSTEMITEM"
>vale.vbrew.com</SPAN
>.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="X-087-2-RESOLV.ROBUSTNESS">6.1.4. Robustez del sistema de resolución</H2
><P
>Si tiene en funcionamiento una red local dentro de otra más grande,
deberá usar servidores de nombres principales siempre que sea
posible. La ventaja de hacerlo así es que se consiguen generosas
memorias <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>caché</I
></SPAN
>, ya que todas las peticiones de nombres les llega a
ellos. Este esquema, sin embargo, tiene un inconveniente: cuando un incendio
inutilizó el cable de red dorsal de nuestro departamento en la Universidad,
no pudimos trabajar, pues ninguno de los servidores de nombres estaban
accesibles. No funcionaban ni los terminales X ni las impresoras...</P
><P
>Aunque no es muy habitual que las redes dorsales de las universidades
sean pasto de las llamas, deberían tomarse precauciones para casos
como éste.</P
><P
>Una solución es poner un servidor de nombres local que se ocupe de sus
nombres locales, y reenvíe todas las peticiones de otros nombres a los
servidores principales. Por supuesto, esto sólo es posible si usted
tiene un dominio propio.</P
><P
>Alternativamente, puede mantener una copia de la tabla de nombres para
su dominio o red local en el fichero <TT
CLASS="FILENAME"
>/etc/hosts</TT
>. En el fichero
<TT
CLASS="FILENAME"
>/etc/host.conf</TT
> deberá incluir la opción
&ldquo;<SPAN
CLASS="SYSTEMITEM"
>order bind,hosts</SPAN
>&rdquo;, 
para obligar a usar el fichero local si el servidor principal
de nombres falla. Si usamos <TT
CLASS="FILENAME"
>/etc/nsswitch.conf</TT
>,
habrá que cambiar la línea que haga referencia a
<SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>hosts</I
></SPAN
>, dejándola así: 
&ldquo;<SPAN
CLASS="SYSTEMITEM"
>hosts: dns files</SPAN
>&rdquo;.

 
 </P
></DIV
></DIV
><H3
CLASS="FOOTNOTES"
>Notas</H3
><TABLE
BORDER="0"
CLASS="FOOTNOTES"
WIDTH="100%"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN4708"
HREF="x-087-2-resolv.library.html#AEN4708"
>[1]</A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>N. del T.: literalmente, burla</P
></TD
></TR
></TABLE
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x-087-2-resolv.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Inicio</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x-087-2-resolv.howdnsworks.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>El servicio de nombres y su configuración</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="x-087-2-resolv.html"
ACCESSKEY="U"
>Subir</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Cómo funciona el DNS</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>