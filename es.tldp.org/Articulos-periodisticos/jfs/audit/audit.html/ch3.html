<!doctype html public "-//W3C//DTD HTML 4.0//EN">

<html>

<head>

<title>Auditorías de Seguridad en GNU/Linux. - Escáneres remotos</title>

<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">

</head>

<body>

<hr>

[ <a href="ch2.html">anterior</a> ]
[ <a href="index.html#abstract">Resumen</a> ]
[ <a href="index.html#copyright">Nota de Copyright</a> ]
[ <a href="index.html#contents">Contenidos</a> ]
[ <a href="ch4.html">siguiente</a> ]

<hr>

<h1>
Auditorías de Seguridad en GNU/Linux.<br>
Capítulo 3 Escáneres remotos
</h1>

<hr>

<h2>
<a name="s-nmap">3.1 Nmap</a>
</h2>

<p>
Nmap es una herramienta para explorar redes y determinar qué servidores están
activos y qué servicios ofrecen.  La ventaja con respecto a otras herramientas
es que ofrece múltiples técnicas de escáner.  Las versiones más recientes
también ofrecen la posibilidad de detectar el sistema operativo remoto en
función a la implementación del protocolo TCP/IP.  El programa dispone incluso,
a partir de la versión 2.0, de un interfaz gráfico realizado con gtk llamado
<code>nmapfe</code> que permite realizar los escáneres sin necesidad de conocer
las múltiples opciones de línea de comandos disponibles.  Se trata de una
herramienta muy útil en conjunción de otras, como <code>scotty</code> (ver <a
href="ch7.html#s-scotty">Scotty (antes tkined), Sección 7.1</a>, para conocer
la estructura de la red heterogénea que se está intentando auditar.  La
posibilidad de hacer un escáner, además, de un grupo de servidores, permite
extraer rápidamente información que pueda servir para hacer un escáner en mayor
profundidad sobre servidores que posiblementa puedan ser comprometidos.
</p>

<hr>

<h2>
<a name="s3.2">3.2 Detectar escáneres remotos</a>
</h2>

<p>
Dado que las herramientas de seguridad mediante tests remotos (SAINT, SATAN...)
pueden convertirse en un arma en manos de una persona que pretenda utilizarla
para fines ilícitos, es necesario disponer de programas que sean capaces de
avisar al administrador cuando se detecte accesso a la máquina realizados por
estos programas con la intención de obtener información o de probar
vulnerabilidades.
</p>

<hr>

<h3>
<a name="s-courtney">3.2.1 Courtney y Gabriel</a>
</h3>

<p>
Este es el caso de <code>Courtney</code> y <code>Gabriel</code>, se verá algo
más de éste último más adelante.  El primero de ellos es un programa
desarrollado en la Universidad de California por Marvin J.  Christensen.  Está
diseñado para detectar este tipo de paquetes.  Aunque se distribuya indicando
que dectará ataques de SATAN en realidad será capaz de detectar un tipo de
ataques concreto, denominado <em>port scanning</em>, consistente en probar
todos (o un gran número) de los puertos de una máquina (cada puerto está ligado
a un servicio, ver <code>inetd.conf(5)</code>).  Los programas pueden así
encontrar servicios vulnerables o no usados para hacerse una idea más precisa
de los servicios ofrecidos por una máquina.

<p>
Se va a estudiar <code>Courtney</code> para observar el funcionamiento de estos
detectores.  Este programa está escrito en Perl, con lo que es más fácil de
interpretar.  El flujo de control del programa es como sigue: una vez leídas e
interpretadas las opciones, ejecuta el programa <code>tcpdump</code> junto con
una reglas de filtro de paquetes.  El programa <code>tcpdump</code> devolverá
todos los paquetes que se lean en una interfaz de red dada que cumplan alguna
de las reglas, estas reglas especifican que, por ejemplo, se deben mostrar los
paquetes dirigidos a diversos puertos.  <code>Courtney</code> leerá de éste
todas las conexiones de interés cuando se produzca alguna, y se apuntará su
origen, posteriormente comprobará si ese mismos origen ha hecho acciones
similares y, si es así, avisa al sistema mediante la llamada a <em>logger</em>
y envía un mensaje de correo al administrador.

<p>
Así pues, si un ordenador accediera uno detrás de otro a todos los puertos de
una máquina que tuviera <code>Courtney</code>, éste empezaría a &quot;hacer
saltar las alarmas&quot; del sistema.  Posteriormente el administrador podría
tomar la decisión de cerrar el acceso a la máquina atacante o no, en función de
la política de seguridad de éste.

<p>
Se puede ajustar el &quot;nivel de alarma&quot; del programa, que indica bajo
qué condiciones se disparará esta.  Hay que fijar adecuadamente este nivel ya
que si es muy bajo se disparará ante eventos que son perfectamente normales (un
usuario de una máquina hace una conexión vía slogin y posteriormente una
conexión de FTP), y si es muy alta no se disparará con los denominados
&quot;ataques ligeros&quot;, que esperan un determinado tiempo antes de
realizar la siguiente conexión.

<p>
Otro programa de las mismas características es <em>Gabriel</em>, diseñado
originalmente para Solaris 1 y 2.  Éste hace algo similar pero utilizando los
filtros de paquetes de estas plataformas (<code>etherfind</code> y
<code>snoop</code> respectivamente), pero además incorpora en su configuración
otras formas de avisar al administrador (ver más abajo)
</p>

<hr>

<h4>
<a name="s3.2.1.1">3.2.1.1 Adaptar Gabriel a GNU/Linux</a>
</h4>

<p>
<em>Gabriel</em> es un programa de Los Altos Technologies, Inc., como ya se ha
indicado detecta escáneres en la red como SATAN.  Pero tiene el aliciente de
que es distribuido, los clientes (implementados en <em>gabriel_client.c</em>)
avisan de un execeso de accesos a la red y el servidor (implementado en
<em>gabriel_server.c</em>) integra la información de estos y avisa de diversas
formas al administador: mediante correo electrónico, vía el demonio
<em>talk</em>, en la pantalla e incluso a través del teléfono o el beeper si
existen las pasarlelas adecuadas (y un módem).

<p>
La idea que da lugar a que exista un cliente y un servidor parte del hecho de
que SATAN es capaz de realizar tests sobre más de un host de una misma red, e
incluso descubrirlos a medida que realiza los tests.  Así, puede ser más fácil
localizar el segmento de red en que se encuentra el ordenador que está
ejecutando SATAN si se recibe la información de todos los ordenadores en varios
segmentos.

<p>
El cliente esta escrito enteramente en C y muy ligado a su plataforma original,
ya que utiliza filtros de paquetes ya existentes, para poder comprobar todos
los paquetes iniciales de conexión (ICMP, UDP y TCP).  En principio sólo tiene
soporte Solaris 1.x o 2.x, y aún no ha sido portado a Linux.  Sin embargo este
programa sirve como muestra botón de la manera en que se portan este tipo de
programas al sistema GNU/Linux.  Una de las ventajas fundamentales es que la
librería de C de los sistemas UNIX es bastante compatible entre diversas
plataformas, con lo que el código original no es necesario casi tocarlo si hace
uso de ésta.  Otra ventaja es que no hace falta modificar casi el servidor, ya
que éste es un shell script que hace uso de programas comúnes en la comunidad
UNIX (como awk)

<p>
Por tanto las modificaciones para poder portar este programa a Linux serían
modificar el cliente para soportar la plataforma Linux haciendo uso de tcpdump,
modificar los scripts de shell caso de que hubiera diferencias entre éstas, y
modificar el fichero <em>Makefile</em> para poder compilar la versión de Linux.
</p>

<hr>

<h3>
<a name="s3.2.2">3.2.2 Scanlogd</a>
</h3>
</p>

<hr>

[ <a href="ch2.html">anterior</a> ]
[ <a href="index.html#abstract">Resumen</a> ]
[ <a href="index.html#copyright">Nota de Copyright</a> ]
[ <a href="index.html#contents">Contenidos</a> ]
[ <a href="ch4.html">siguiente</a> ]

<hr>

Auditorías de Seguridad en GNU/Linux.<br>

<address>
15 feb 1999<br>
Javier Fernández-Sanguino Peña <code><a href="mailto:jfs@computer.org">jfs@computer.org</a></code>
</address>

</body>

</html>

