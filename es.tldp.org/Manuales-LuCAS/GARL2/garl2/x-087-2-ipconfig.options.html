<HTML
><HEAD
><TITLE
>Opciones de Configuración IP</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.76b+
"><LINK
REL="HOME"
TITLE="Guía de Administración de Redes con Linux"
HREF="index.html"><LINK
REL="UP"
TITLE="El Protocolo Punto-a-Punto"
HREF="x-087-2-ppp.html"><LINK
REL="PREVIOUS"
TITLE="Realización de la Llamada con chat"
HREF="x6765.html"><LINK
REL="NEXT"
TITLE="Opciones de Control de Enlace"
HREF="x7053.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="publicacoes.css"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Guía de Administración de Redes con Linux</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x6765.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Capítulo 8. El Protocolo Punto-a-Punto</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x7053.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="X-087-2-IPCONFIG.OPTIONS">8.5. Opciones de Configuración IP</H1
><P
>&#13;El IPCP se utiliza para negociar varios parámetros IP a la hora de configurar
la conexión. Normalmente, cada extremo de comunicación puede enviar un Paquete
de Petición de Configuración IPCP, indicando qué valores quiere cambiar de los
que vienen predeterminados, y a qué valor. Tras la recepción, el extremo remoto
inspecciona cada opción sucesivamente, y responde que la acepta, o la rechaza.</P
><P
><B
CLASS="COMMAND"
>pppd</B
> le da gran control sobre qué opciones intentará
negociar el IPCP. Puede ajustar esto a través de varias opciones en la línea
de órdenes de las que hablamos a continuación.</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN6872">8.5.1. Eligiendo Direcciones IP</H2
><P
>&#13;

Todos los interfaces IP requieren de direcciones IP asignadas a ellos; Un dispositivo
PPP siempre tiene una dirección IP. El conjunto de protocolos PPP provee un mecanismo
que permite la asignación automática de direcciones IP a interfaces PPP. Es posible
para el programa PPP en un extremo del enlace punto a punto asignar una dirección IP
al extremo opuesto para que la use, o que cada uno use la suya.</P
><P
>Algunos servidores PPP que sirven a muchos clientes asignan direcciones
dinámicamente: las direcciones son asignadas a los sistemas sólo cuando
llaman, y son reclamadas de nuevo una vez que se desconecta. Esto permite
que el número de direcciones IP requeridas esté limitado al número de
líneas conectadas. Mientras la limitación es conveniente para quienes
gestionan los servidoresde marcado PPP, es a menudo menos conveniente
para los usuarios que están intentando conectar. Ya discutimos la forma en
la que los nombres de nodo son transformados en direccionnes IP mediante una base
de datos en <A
HREF="x-087-2-resolv.html"
>Capítulo 6</A
>. Para permitir que la gente se
conecte a su nodo, ellos deben saber su dirección IP o el nombre del nodo asociado
a ella. Si usted es usuario de un servicio PPP que le asigna una dirección IP
de forma dinámica, este conocimiento es difícil sin permitir de alguna manera a la
base de datos DNS que se actualice después de que le es asignada la dirección IP.
Este tipo de sistemas existen, pero nosotros no los cubriremos en detalle aquí;
en cambio, miraremos hacia una situación más preferible, la cual implica que
sea capaz de utilizar la misma dirección IP cada vez que se establece su
conexión de red.
<A
NAME="X-087-2-FNPP07"
HREF="#FTN.X-087-2-FNPP07"
>[1]</A
></P
><P
>En el ejemplo anterior, hacíamos que <B
CLASS="COMMAND"
>pppd</B
> llamase
a <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
> y estableciera una conexión IP.
No nos preocupábamos de elegir una dirección IP particular en ninguno de los
extremos de la conexión. En vez de ello, tomábamos la dirección de
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> como la dirección IP local, y
dejábamos a <SPAN
CLASS="SYSTEMITEM"
>c3po</SPAN
> darse su propia
dirección. El pppd soporta diferentes alternativas a esta aproximación.</P
><P
>Para pedir direcciones particulares, normalmente dé a <B
CLASS="COMMAND"
>pppd</B
>
la siguiente opción:

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    <TT
CLASS="REPLACEABLE"
><I
>local_addr</I
></TT
>:<TT
CLASS="REPLACEABLE"
><I
>remote_addr</I
></TT
></PRE
></TD
></TR
></TABLE
></P
><P
><TT
CLASS="REPLACEABLE"
><I
>local_addr</I
></TT
> y 
<TT
CLASS="REPLACEABLE"
><I
>remote_addr</I
></TT
> pueden ser especificados tanto en
notación de cuaternas numéricas o como nombres de nodo.<A
NAME="X-087-2-FNPP08"
HREF="#FTN.X-087-2-FNPP08"
>[2]</A
>
Esta opción hace a <B
CLASS="COMMAND"
>pppd</B
> intentar usar la primera dirección como
su propia dirección IP, y la segunda como la de su compañero. Si el compañero
rechaza alguna de ellas durante la negociación IPCP, no se establecerá ninguna
conexión IP.<A
NAME="X-087-2-FNPP09"
HREF="#FTN.X-087-2-FNPP09"
>[3]</A
></P
><P
>&#13;Si usted está llamando a un servidor y espera que éste le asigne una
dirección IP, debe asegurarse de que <B
CLASS="COMMAND"
>pppd</B
> no intenta
negociar una por sí mismo. Para hacer esto, use la opción <TT
CLASS="OPTION"
>noipdefault</TT
>
y deje la opción <TT
CLASS="REPLACEABLE"
><I
>local_addr</I
></TT
> en blanco.
La opción <TT
CLASS="OPTION"
>noipdefault</TT
> evitará que  <B
CLASS="COMMAND"
>pppd</B
>
intente usar la dirección IP asociada al nombre de ordenador como la dirección local.</P
><P
>Si sólo quiere establecer la dirección local, y aceptar cualquier dirección
que utilice el compañero, simplemente deseche la parte 
<TT
CLASS="REPLACEABLE"
><I
>remote_addr</I
></TT
>. Por ejemplo, para hacer
a <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> usar la dirección
IP <SPAN
CLASS="SYSTEMITEM"
>130.83.4.27</SPAN
> en vez de la suya
propia, le escribiría <TT
CLASS="OPTION"
>130.83.4.27:</TT
>
en la línea de orden. De forma similar, para establecer la dirección remota
únicamente, dejaría el campo de la <TT
CLASS="REPLACEABLE"
><I
>dir_local</I
></TT
> en blanco.
Por omisión, <B
CLASS="COMMAND"
>pppd</B
> utilizará entonces la dirección
asociada al nombre de su ordenador.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN6930">8.5.2. Encaminamiento a través de un enlace PPP</H2
><P
>&#13;
Tras configurar el interfaz de red, <B
CLASS="COMMAND"
>pppd</B
> preparará un
encaminamiento que solamente le sirve para comunicarse con el otro extremo.
Si el ordenador remoto está en una red de área local, seguramente usted
deseará conectar también con los ordenadores que están "detrás" de él; para
eso, se ha de configurar un encaminamiento de red adecuado.</P
><P
>Ya hemos visto antes que se puede pedir a <B
CLASS="COMMAND"
>pppd</B
> que
configure el encaminamiento predeterminado utilizando la opción
<TT
CLASS="OPTION"
>defaultroute</TT
>. Esta opción es muy útil si el servidor PPP al
que llama va a actuar como su pasarela a Internet.</P
><P
>&#13;

El caso contrario, cuando su sistema actúa como una pasarela para un sólo
ordenador, es también relativamente fácil de llevar a cabo. Por ejemplo,
imagine a algún empleado de la Cervecera Virtual cuyo ordenador de casa se
llama <SPAN
CLASS="SYSTEMITEM"
>oneshot</SPAN
>. Cuando esté conectando
a <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> a través de PPP, él utiliza
una dirección de la subred de la Cervecera. Podremos dar a <B
CLASS="COMMAND"
>pppd</B
> del ordenador
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> la opción <TT
CLASS="OPTION"
>proxyarp</TT
>,
que instalará una entrada proxy-ARP para el ordenador <SPAN
CLASS="SYSTEMITEM"
>oneshot</SPAN
>. Esto hará que
<SPAN
CLASS="SYSTEMITEM"
>oneshot</SPAN
> sea automáticamente accesible desde todos
los ordenadores de la Cervecera y la Vinatera.</P
><P
>&#13;De cualquier manera, las cosas no son siempre tan fáciles como esto, por ejemplo
cuando intentamos unir dos redes de área local. Esto requiere normalmente el
añadir una ruta de red especifica, porque estas redes tendrán ya sus propios
encaminamientos por defecto. Por otra parte, el tener los dos extremos de
comunicación utilizando la conexión PPP como encaminamiento por defecto
generaría un ciclo sin fin, donde los paquetes con destinos desconocidos
rebotarían entre los dos ordenadores hasta que su tiempo de vida (TTL) expirase.</P
><P
>Pongamos un ejemplo: suponga que la Cervecera Virtual abre una sucursal en
alguna otra ciudad. La sucursal utiliza su propia red Ethernet utilizando el
número de red IP <SPAN
CLASS="SYSTEMITEM"
>172.16.3.0</SPAN
>, que es
la subred 3 de la red de clase B de la Cervecera. Quieren conectarse a la red
Ethernet principal de la Cervecera a través de PPP para actualizar las bases
de datos de clientes, etc. De nuevo, <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>
actuará como pasarela; la otra máquina se llama <SPAN
CLASS="SYSTEMITEM"
>vbourbon</SPAN
>
y tiene una dirección IP de <SPAN
CLASS="SYSTEMITEM"
>172.16.3.1</SPAN
>.
Esta red está ilustrada en <A
HREF="x-087-2-appendix.brewery.html#X-087-2-APPENDIX.BREWERY.SUBSIDIARY"
>Figura A-2</A
> en
<A
HREF="x-087-2-appendix.brewery.html"
>Apéndice A</A
>.</P
><P
>Cuando <SPAN
CLASS="SYSTEMITEM"
>vbourbon</SPAN
> conecta
a <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>, hará que el punto de
encaminamiento predeterminado sea <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>,
como es habitual. En <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>, de todas
formas, tendremos que instalar un encaminamiento de red para la subred 3 que vaya
a través de <SPAN
CLASS="SYSTEMITEM"
>vbourbon</SPAN
>.
Podriamos hacer esto manualmente usando la orden <B
CLASS="COMMAND"
>route</B
> después
de que el enlace PPP sea establecido, pero esta no es una solución muy práctica.
Afortunadamente, podemos configurar la ruta automáticamente utilizando una
característica de <B
CLASS="COMMAND"
>pppd</B
> de la que no hemos hablado hasta
ahora - la orden <B
CLASS="COMMAND"
>ip-up</B
>. Es un script de
shell situado en <TT
CLASS="FILENAME"
>/etc/ppp</TT
> que se ejecuta después de que el
interfaz PPP ha sido configurado. Cuando está presente, se le llama con los
siguientes parámetros:

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    ip-up <TT
CLASS="REPLACEABLE"
><I
>interface</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>dispositivo</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>velocidad</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>dir_local</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>dir_remota</I
></TT
></PRE
></TD
></TR
></TABLE
></P
><P
>La tabla siguiente resume el significado de cada uno de los argumentos (en la primera
columna, se muestra el número usado por el script de shell para referirse a cada
argumento):

<DIV
CLASS="INFORMALTABLE"
><A
NAME="AEN6987"><P
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><THEAD
><TR
><TH
WIDTH="24"
ALIGN="LEFT"
VALIGN="TOP"
>Argumento</TH
><TH
WIDTH="24"
ALIGN="LEFT"
VALIGN="TOP"
>Nombre</TH
><TH
WIDTH="264"
ALIGN="LEFT"
VALIGN="TOP"
>Propósito</TH
></TR
></THEAD
><TBODY
><TR
><TD
WIDTH="24"
ALIGN="LEFT"
VALIGN="TOP"
>&dollar;1</TD
><TD
WIDTH="24"
ALIGN="LEFT"
VALIGN="TOP"
><TT
CLASS="REPLACEABLE"
><I
>interfaz</I
></TT
></TD
><TD
WIDTH="264"
ALIGN="LEFT"
VALIGN="TOP"
><P
>	Interfaz de red usado, e.g., <TT
CLASS="LITERAL"
>ppp0</TT
>	
	</P
></TD
></TR
><TR
><TD
WIDTH="24"
ALIGN="LEFT"
VALIGN="TOP"
>&dollar;2</TD
><TD
WIDTH="24"
ALIGN="LEFT"
VALIGN="TOP"
><TT
CLASS="REPLACEABLE"
><I
>dispositivo</I
></TT
></TD
><TD
WIDTH="264"
ALIGN="LEFT"
VALIGN="TOP"
><P
>	dispositivo es la ruta al dispositivo serie utilizado,(&hairsp;<TT
CLASS="FILENAME"
>/dev/tty</TT
>
	si se utiliza la salida y entrada estándar)
	</P
></TD
></TR
><TR
><TD
WIDTH="24"
ALIGN="LEFT"
VALIGN="TOP"
>&dollar;3</TD
><TD
WIDTH="24"
ALIGN="LEFT"
VALIGN="TOP"
><TT
CLASS="REPLACEABLE"
><I
>velocidad</I
></TT
></TD
><TD
WIDTH="264"
ALIGN="LEFT"
VALIGN="TOP"
><P
>	
	La velocidad del dispositivo en bits por segundo.
	</P
></TD
></TR
><TR
><TD
WIDTH="24"
ALIGN="LEFT"
VALIGN="TOP"
>&dollar;4</TD
><TD
WIDTH="24"
ALIGN="LEFT"
VALIGN="TOP"
><TT
CLASS="REPLACEABLE"
><I
>dir_local</I
></TT
></TD
><TD
WIDTH="264"
ALIGN="LEFT"
VALIGN="TOP"
><P
>	La dirección IP del extremo local del enlace en notación de cuarteto.
	</P
></TD
></TR
><TR
><TD
WIDTH="24"
ALIGN="LEFT"
VALIGN="TOP"
>&dollar;5</TD
><TD
WIDTH="24"
ALIGN="LEFT"
VALIGN="TOP"
><TT
CLASS="REPLACEABLE"
><I
>dir_remota</I
></TT
></TD
><TD
WIDTH="264"
ALIGN="LEFT"
VALIGN="TOP"
><P
>	La dirección IP del extremo remoto de la conexión
	</P
></TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></P
><P
> 
En nuestro caso, el script <B
CLASS="COMMAND"
>ip-up</B
> puede contener el
siguiente fragmento de código:<A
NAME="X-087-2-FNPP10"
HREF="#FTN.X-087-2-FNPP10"
>[4]</A
>

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    #!/bin/sh
    case $5 in
    172.16.3.1)            # este es vbourbon
            route add -net 172.16.3.0 gw 172.16.3.1;;
    ...
    esac
    exit 0</PRE
></TD
></TR
></TABLE
></P
><P
>De una forma análoga,<B
CLASS="COMMAND"
>/etc/ppp/ip-down</B
> se utiliza para deshacer
todas las acciones de <B
CLASS="COMMAND"
>ip-up</B
> después de que la conexión PPP
ha sido cortada. Asi en nuestro script <B
CLASS="COMMAND"
>/etc/ppp/ip-down</B
> tendremos
una orden <B
CLASS="COMMAND"
>route</B
> que elimine la ruta que creamos con el 
script <B
CLASS="COMMAND"
>/etc/ppp/ip-up</B
>. </P
><P
>&#13;
A pesar de todo, la tabla de encaminamiento aún no está completa. Hemos
configurado las entradas de la tabla de encaminamiento para los dos
ordenadores con PPP, pero hasta ahora, todos los demás ordenadores de las
dos redes no saben nada sobre la conexión PPP. Esto no es un gran
problema si todos los ordenadores de la sucursal tienen
su encaminamiento predeterminado encaminado a <SPAN
CLASS="SYSTEMITEM"
>vbourbon</SPAN
>,
y todos los ordenadores de la Cervecera encaminan hacia
<SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
> por omisión. Si éste no fuera el
caso, su única posibilidad normalmente será usar un demonio de encaminamiento como
<B
CLASS="COMMAND"
>gated</B
>. Tras crear el encaminamiento de la red
en <SPAN
CLASS="SYSTEMITEM"
>vlager</SPAN
>, el demonio de encaminamiento
pasará el nuevo encaminamiento a todos los ordenadores de las redes dependientes de ésta.&#13;</P
></DIV
></DIV
><H3
CLASS="FOOTNOTES"
>Notas</H3
><TABLE
BORDER="0"
CLASS="FOOTNOTES"
WIDTH="100%"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP07"
HREF="x-087-2-ipconfig.options.html#X-087-2-FNPP07"
>[1]</A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Más información sobre mecanismos de asignación dinámica 
a nodos puede encontrarse aquí: 
<SPAN
CLASS="SYSTEMITEM"
>http://www.dynip.com/</SPAN
> y 
<SPAN
CLASS="SYSTEMITEM"
>http://www.justlinux.com/dynamic_dns.html</SPAN
>.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP08"
HREF="x-087-2-ipconfig.options.html#X-087-2-FNPP08"
>[2]</A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
> Usar nombres de dominio en esta opción tiene
consecuencias en la autentificación CHAP. Por favor, consulte la sección <A
HREF="x-087-2-ppp.authentication.html"
>Sección 8.8</A
>&rdquo; más adelante en este mismo capítulo.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP09"
HREF="x-087-2-ipconfig.options.html#X-087-2-FNPP09"
>[3]</A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Las opciones <TT
CLASS="OPTION"
>ipcp-accept-local</TT
> y <TT
CLASS="OPTION"
>ipcp-accept-remote</TT
>
indican a <B
CLASS="COMMAND"
>pppd</B
> aceptar la dirección local y remota ofrecidas
por el PPP remoto, incluso si usted a provisto de alguna en su configuración. Si
estas opciones no son configuradas, su <B
CLASS="COMMAND"
>pppd</B
> rechazará cualquier
intento de negociación de las direcciones IP usadas.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNPP10"
HREF="x-087-2-ipconfig.options.html#X-087-2-FNPP10"
>[4]</A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Si quisieramos tener rutas creadas para otros sitios cuando se conecten,
tendriamos que añadir entradas apropiadas para permitir a aquellos
<TT
CLASS="LITERAL"
>...</TT
> que aparecieran en el ejemplo.</P
></TD
></TR
></TABLE
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x6765.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Inicio</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x7053.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Realización de la Llamada con chat</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="x-087-2-ppp.html"
ACCESSKEY="U"
>Subir</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Opciones de Control de Enlace</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>