<HTML
><HEAD
><TITLE
>Procesar Artículos por Lotes</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.76b+
"><LINK
REL="HOME"
TITLE="Guía de Administración de Redes con Linux"
HREF="index.html"><LINK
REL="UP"
TITLE="C-News"
HREF="x-087-2-cnews.html"><LINK
REL="PREVIOUS"
TITLE="El Fichero active"
HREF="x-087-2-cnews.active.html"><LINK
REL="NEXT"
TITLE="Caducando Noticias"
HREF="x-087-2-cnews.explist.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="publicacoes.css"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Guía de Administración de Redes con Linux</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x-087-2-cnews.active.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Capítulo 21. C-News</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x-087-2-cnews.explist.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="X-087-2-CNEWS.BATCHER">21.5. Procesar Artículos por Lotes</H1
><P
>&#13;



Los lotes de noticias siguen un formato particular, el cual es el mismo para
Bnews, C-News e INN. Cada artículo está precedido por una línea como esta:

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    #! rnews <TT
CLASS="REPLACEABLE"
><I
>count</I
></TT
></PRE
></TD
></TR
></TABLE
></P
><P
>donde <TT
CLASS="REPLACEABLE"
><I
>count</I
></TT
> es el número de bytes en el artículo. 
Cuando se usa la compresión de lotes, el fichero resultante es comprimido como
un todo, y precedido por otra línea, que indica el mensaje a ser usado por la
compresión. la herramienta de compresión estándar es
<SPAN
CLASS="SYSTEMITEM"
>compress</SPAN
>, la cual se indica con:

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    #! cunbatch</PRE
></TD
></TR
></TABLE
></P
><P
>Algunas veces, cuando hay que enviar los lotes usando un software de correo que 
elimina el octavo bit de todos los datos, se puede proteger un lote usando un método
de codificación llamado <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>codificación c7</I
></SPAN
>(c7-encoding, en inglés); 
estos lotes serán marcados por <B
CLASS="COMMAND"
>c7unbatch</B
>.</P
><P
>Cuando se le suministra un lote <B
CLASS="COMMAND"
>rnews</B
> en el servidor remoto, éste
comprueba esas marcas y procesa el lote apropiadamente. 
Algunos servidores también usan otras herramientas de compresión tales como <B
CLASS="COMMAND"
>gzip</B
>,
y en su lugar, preceden a sus ficheros comprimidos con <B
CLASS="COMMAND"
>zunbatch</B
>. 
C-News no reconoce cabeceras no estándares como esas; Ud. deberá modificar el código
fuente para darle soporte.</P
><P
>&#13;En C-News, el proceso por lotes de ficheros lo realiza <TT
CLASS="FILENAME"
>/usr/lib/news/batch/sendbatches</TT
>,
el cual recoge la lista de artículos del fichero <TT
CLASS="FILENAME"
>site/togo</TT
> y los pone en varios lotes
de noticias. Debería ejecutarse una vez cada hora, o incluso más a menudo, dependiendo del volumen de tráfico.

Esta operación es controlada por el fichero <TT
CLASS="FILENAME"
>batchparms</TT
> situado en
<TT
CLASS="FILENAME"
>/var/lib/news</TT
>. 
Este fichero describe el máximo tamaño de lote permitido para cada servidor, el tipo de proceso
por lotes y opcionalmente el programa de compresión usado, además del método de transporte para entregarlo
al servidor remoto. Puede especificar los parámetros del proceso por lotes para cada servidor, además
de un conjunto de parámetros predeterminados para servidores no mencionados explícitamente.</P
><P
>Cuando instale C-News, seguramente hallará un fichero de nombre <TT
CLASS="FILENAME"
>batchparms</TT
> 
en su distribución que contenga una entrada predeterminada, con valores razonables, así que es 
muy probable que no tenga que tocar el fichero. No obstante, describimos su formato por si acaso.
Cada línea consta de seis campos, separados por espacios o tabuladores:

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    <TT
CLASS="REPLACEABLE"
><I
>sitio</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>tamaño</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>max</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>batcher</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>muncher</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>transporte</I
></TT
></PRE
></TD
></TR
></TABLE
></P
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>sitio</I
></TT
></DT
><DD
><P
><TT
CLASS="REPLACEABLE"
><I
>sitio</I
></TT
> es el nombre del servidor al que se aplica la entrada.
El fichero <TT
CLASS="FILENAME"
>togo</TT
> para este servidor debe residir en
<TT
CLASS="FILENAME"
>out.going&thinsp;/togo</TT
> bajo la cola de noticias. Un servidor llamado
<SPAN
CLASS="SYSTEMITEM"
>/default/</SPAN
> denota la entrada predeterminada
y coincide con cualquier servidor que no sea especificado con una única entrada.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>tamaño</I
></TT
></DT
><DD
><P
><TT
CLASS="REPLACEABLE"
><I
>tamaño</I
></TT
> es el tamaño máximo de los lotes creados (antes de la compresión).
Para aquellos artículos que son mayores que este valor, C-News hace una excepción y los pone en 
un lote a ellos solos.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>max</I
></TT
></DT
><DD
><P
><TT
CLASS="REPLACEABLE"
><I
>max</I
></TT
> es el máximo número de lotes creados y programados
para la transferencia antes de que el proceso por lotes se interrumpa para este 
servidor en particular. Esto es útil en el caso de que el servidor remoto no esté
disponible durante un largo período de tiempo, porque previene que C-News ateste sus
directorios de cola UUCP con millones de lotes de noticias.</P
><P
>C-News determina el número de lotes que hay en cola usando el guión 
<B
CLASS="COMMAND"
>queuelen</B
> situado en <TT
CLASS="FILENAME"
>/usr/lib/news/</TT
>.
Si ha instalado C-News desde paquetes, el guión no necesita retoques, pero
si elige lugares diferentes para los directorios de cola, por ejemplo para
Taylor UUCP, deberá crear su propia versión del guión. Si no le importa
el número de ficheros de cola (porque Ud. es la única persona usando el ordenador, 
y no escribe artículos gigantes), puede reemplazar el contenido del guión
por una simple sentencia <B
CLASS="COMMAND"
>exit 0</B
>.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>batcher</I
></TT
></DT
><DD
><P
>&#13;El campo <TT
CLASS="REPLACEABLE"
><I
>batcher</I
></TT
> contiene la orden usada para
producir un lote a partir de la lista de artículos del fichero <TT
CLASS="FILENAME"
>togo</TT
>.
Para las fuentes habituales, éste es generalmente <B
CLASS="COMMAND"
>batcher</B
>. 
Puede que se proporcionen otros empaquetadores para otros propósitos. Por ejemplo,
el protocolo ihave/sendme requiere que la lista de artículos sea convertida en
mensajes de control <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>ihave</I
></SPAN
> o <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>sendme</I
></SPAN
>, los 
cuales se envían al grupo <SPAN
CLASS="SYSTEMITEM"
>to.site</SPAN
>. 
Esto lo  realizan las instrucciones <B
CLASS="COMMAND"
>batchih</B
> y <B
CLASS="COMMAND"
>batchsm</B
> 
respectivamente.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>muncher</I
></TT
></DT
><DD
><P
>&#13;El campo <TT
CLASS="REPLACEABLE"
><I
>compresión</I
></TT
> especifica la orden a usar
para la compresión de los lotes. Generalmente, se usa <SPAN
CLASS="SYSTEMITEM"
>compcun</SPAN
>, un guión que produce lotes 
comprimidos<A
NAME="X-087-2-FNCN06"
HREF="#FTN.X-087-2-FNCN06"
>[1]</A
>.
Alternativamente, puede proporcionar un muncher que use <B
CLASS="COMMAND"
>gzip</B
>, 
para comprimir, digamos <TT
CLASS="USERINPUT"
><B
>gzipcun</B
></TT
> (para ser claros:
tiene que escribirlo usted mismo&thinsp;).  Debe asegurarse de que
<B
CLASS="COMMAND"
>uncompress</B
> en el servidor remoto esté parcheado para
reconocer ficheros comprimidos con <B
CLASS="COMMAND"
>gzip</B
>.</P
><P
>Si el servidor remoto no tiene una orden <B
CLASS="COMMAND"
>uncompress</B
>,
debe especificar <B
CLASS="COMMAND"
>nocomp</B
>, lo que implica que no se realice 
compresión alguna.</P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>transporte</I
></TT
></DT
><DD
><P
>El último campo, <TT
CLASS="REPLACEABLE"
><I
>transporte</I
></TT
>, describe el 
transporte a ser utilizado. Hay disponibles varias órdenes estándar
para diferentes transportes cuyos nombres empiezan con
<B
CLASS="COMMAND"
>via</B
>.  <B
CLASS="COMMAND"
>sendbatches</B
> les pasa el
nombre del servidor de destino en la línea de órdenes. Si la entrada
<TT
CLASS="FILENAME"
>batchparms</TT
> no era <SPAN
CLASS="SYSTEMITEM"
>/default/</SPAN
>, <B
CLASS="COMMAND"
>sendbatches</B
>
deriva el nombre del servidor del campo <TT
CLASS="REPLACEABLE"
><I
>sitio</I
></TT
>
suprimiendo cualquier cosa después e incluyendo el primer punto o barra inclinada.
Si la entrada <SPAN
CLASS="SYSTEMITEM"
>batchparms</SPAN
> es
<SPAN
CLASS="SYSTEMITEM"
>/default/</SPAN
>, se usa el nombre del directorio
introducido en <TT
CLASS="FILENAME"
>out.going</TT
>.</P
></DD
></DL
></DIV
><P
>Para llevar a cabo el proceso por lotes para un servidor específico, se invoca como:

<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    # <TT
CLASS="USERINPUT"
><B
>su news -c "/usr/lib/news/batch/sendbatches site"</B
></TT
></PRE
></TD
></TR
></TABLE
></P
><P
>&#13;Cuando se invoca sin argumentos, <B
CLASS="COMMAND"
>sendbatches</B
> maneja todas las colas de lotes. 
La interpretación de &ldquo;todas&rdquo; depende de una entrada predeterminada en <TT
CLASS="FILENAME"
>batchparms</TT
>. 
Si se encuentra una, se comprueban todos los directorios de <TT
CLASS="FILENAME"
>/var/spool/news/out.going</TT
>;
si no, <B
CLASS="COMMAND"
>sendbatches</B
> recorre todas las entradas de
<TT
CLASS="FILENAME"
>batchparms</TT
>, procesando solamente los lugares encontrados.
Note que <B
CLASS="COMMAND"
>sendbatches</B
>, cuando explora el directorio
<TT
CLASS="FILENAME"
>out.going</TT
> toma sólo aquellos directorios que no contienen ningún
punto o símbolo arroba (<SPAN
CLASS="SYSTEMITEM"
>@</SPAN
>)como nombre de servidor.</P
><P
>&#13;

Hay dos órdenes que usan <B
CLASS="COMMAND"
>uux</B
> para ejecutar
<B
CLASS="COMMAND"
>rnews</B
> en el servidor remoto:
<B
CLASS="COMMAND"
>viauux</B
> y <B
CLASS="COMMAND"
>viauuxz</B
>. El último
establece el parámetro <TT
CLASS="OPTION"
>&ndash;z</TT
> para <B
CLASS="COMMAND"
>uux</B
>, el cual, 
previene que versiones más antiguas de uux devuelvan mensajes de éxito por cada artículo
entregado. Otra orden, <B
CLASS="COMMAND"
>viamail</B
>, envía los lotes
de artículos al usuario <SPAN
CLASS="SYSTEMITEM"
>rnews</SPAN
> en
el servidor remoto vía correo.  Por supuesto, esto requiere 
que el sistema remoto administre de alguna manera todo el correo para <SPAN
CLASS="SYSTEMITEM"
>rnews</SPAN
> a su sistema local de noticias. 
Para obtener una lista completa de estos transportes, refiérase a las páginas del 
manual de <TT
CLASS="FILENAME"
>newsbatch</TT
>.</P
><P
>Todas las órdenes de los tres últimos campos deben estar situados, bien en
<TT
CLASS="FILENAME"
>out.going/site</TT
> o en <TT
CLASS="FILENAME"
>/usr/lib/news/batch</TT
>. 
La mayoría de ellos son guiones, de tal forma que pueda confeccionar fácilmente
nuevas herramientas para sus necesidades personales y son invocadas a través de tuberías
(pipes). La lista de artículos se suministra al batches por su entrada estándar, la cual
produce el lote en su salida estándar. Esto a su vez, se vuelve a entubar en el muncher, y así
sucesivamente.</P
><P
>Aquí hay un ejemplo:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>    # fichero batchparms para la cervecera
    # site        | size   |max    |batcher  |muncher    |transport
    #-------------+--------+-------+---------+-----------+-----------
    /default/       100000  22      batcher   compcun     viauux
    swim             10000  10      batcher   nocomp      viauux</PRE
></TD
></TR
></TABLE
></DIV
><H3
CLASS="FOOTNOTES"
>Notas</H3
><TABLE
BORDER="0"
CLASS="FOOTNOTES"
WIDTH="100%"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.X-087-2-FNCN06"
HREF="x-087-2-cnews.batcher.html#X-087-2-FNCN06"
>[1]</A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>Tal como se distribuye con
C-News, <SPAN
CLASS="SYSTEMITEM"
>compcun</SPAN
> usa
<SPAN
CLASS="SYSTEMITEM"
>compress</SPAN
> con la opción 12-bit
, ya que éste es el mínimo común denominador de la mayoría de los servidores. 
Puede hacer una copia del guión, digamos <SPAN
CLASS="SYSTEMITEM"
>compcun16</SPAN
>, y usar el método de compresión 16-bit. 
De todas formas, la mejora en rendimiento no es muy impresionante.</P
></TD
></TR
></TABLE
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x-087-2-cnews.active.html"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Inicio</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x-087-2-cnews.explist.html"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>El Fichero active</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="x-087-2-cnews.html"
ACCESSKEY="U"
>Subir</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Caducando Noticias</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>