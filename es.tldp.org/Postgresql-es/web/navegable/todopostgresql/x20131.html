<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<HTML
><HEAD
><TITLE
>Funciones de Ejecución de Consultas</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.59"><LINK
REL="HOME"
TITLE="PostgreSQL"
HREF="postgres.html"><LINK
REL="UP"
TITLE="libpq"
HREF="libpq-chapter.html"><LINK
REL="PREVIOUS"
TITLE="libpq"
HREF="libpq-chapter.html"><LINK
REL="NEXT"
TITLE="Procesamiento Asíncrono de Consultas"
HREF="x20284.html"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PostgreSQL</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="libpq-chapter.html"
>Anterior</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>libpq</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x20284.html"
>Siguiente</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN20131"
>Funciones de Ejecución de Consultas</A
></H1
><P
>Una vez que se ha establecido correctamente una conexión con un servidor de base
de datos, se utilizan las funciones que se muestran a continuación para realizar
consultas y comandos de SQL.
<P
></P
><UL
><LI
><P
><TT
CLASS="FUNCTION"
>PQexec</TT
>
          Emite una consulta a <SPAN
CLASS="PRODUCTNAME"
>Postgres</SPAN
>
          y espera el resultado.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>PGresult *PQexec(PGconn *conn,
                 const char *query);</PRE
></TD
></TR
></TABLE
>
          Devuelve un puntero PGresult o, posiblemente, un puntero NULL.
          Generalmente devolverá un puntero no nulo, excepto en condiciones de 
          "fuera de memoria" (out-of-memory) o errores serios tales como la 
          incapacidad de enviar la consulta al servidor. Si se devuelve un
          puntero nulo, se debería tratar de la misma forma que un resulado
          PGRES_FATAL_ERROR. Para conseguir más información sobre el error, 
          utilice PQerrorMessage.</P
></LI
></UL
></P
><P
>La estructura <TT
CLASS="FUNCTION"
>PGresult</TT
> encapsula el resultado devuelto por
el servidor a la consulta. Los programadores de aplicaciones con 
<TT
CLASS="FILENAME"
>libpq</TT
> deberían mostrarse cuidadosos de mantener la
abstracción de PGresult. Prohiban la referencia directa a los campos de la
estructura PGresult, porque están sujetos a cambios en el futuro.
(Incluso a partir de la versión 6.4 de <SPAN
CLASS="PRODUCTNAME"
>Postgres</SPAN
>,
ha dejado de proporcionarse la definición de PGresult en libpq-fe.h.  Si tiene
usted código antíguo que accede directamente a los campos de PGresult, puede
mantenerlo utilizando libpq-int.h también, pero le recomendamos que ajuste 
pronto el código).

<P
></P
><UL
><LI
><P
><TT
CLASS="FUNCTION"
>PQresultStatus</TT
>
          Devuelve la situación (status) resultante de una consulta.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>ExecStatusType PQresultStatus(const PGresult *res)</PRE
></TD
></TR
></TABLE
>
PQresultStatus puede devolver uno de los siguentes valores:
<P
></P
><UL
><LI
><P
><TT
CLASS="LITERAL"
>PGRES_EMPTY_QUERY</TT
> -- La cadena enviada al servidor estaba vacía.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>PGRES_COMMAND_OK</TT
> -- El comando se ha ejecutado con éxito sin devolver datos.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>PGRES_TUPLES_OK</TT
> -- La consulta se ha ejecutado con éxito.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>PGRES_COPY_OUT</TT
> -- Se ha arrancado la transmisión de datos desde el servidor (Copy Out)</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>PGRES_COPY_IN</TT
> -- Se ha arrancado la transmisión de datos hacia el servidor (Copy In)</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>PGRES_BAD_RESPONSE</TT
> -- El servidor ha dado una respuesta desconocida.</P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>PGRES_NONFATAL_ERROR</TT
></P
></LI
><LI
><P
><TT
CLASS="LITERAL"
>PGRES_FATAL_ERROR</TT
></P
></LI
></UL
>

Si al situación del resultado es <TT
CLASS="LITERAL"
>PGRES_TUPLES_OK</TT
>, las rutinas
descritas más abajo se pueden utilizar para recuperar las tuplas devueltas por
la consulta. Tengase en cuenta que una SELECT que intente recuperar 0 (cero) tuplas
también mostrará <TT
CLASS="LITERAL"
>PGRES_TUPLES_OK</TT
>. 
<TT
CLASS="LITERAL"
>PGRES_COMMAND_OK</TT
> es para comandos que nunca devuelven tuplas
(INSERT, UPDATE, etc). Una respuesta <TT
CLASS="LITERAL"
>PGRES_EMPTY_QUERY</TT
> indica
que hay un error en el programa cliente.</P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQresStatus</TT
>
        Convierte los tipos enumerados devueltos por PQresultStatus en una cadena
        constante que describe el código de la situación.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>char *PQresStatus(ExecStatusType status);</PRE
></TD
></TR
></TABLE
></P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQresultErrorMessage</TT
>
Devuelve el mensaje de error asociado con la consulta, o una cadena vacía si no 
hay error.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>char *PQresultErrorMessage(const PGresult *res);</PRE
></TD
></TR
></TABLE
>
Siguiendo inmediatamente a una llamada a <TT
CLASS="FUNCTION"
>PQexec</TT
> o 
<TT
CLASS="FUNCTION"
>PQgetResult</TT
>, <TT
CLASS="FUNCTION"
>PQerrorMessage</TT
> (sobre la 
conexión) devolverá la misma cadena que <TT
CLASS="FUNCTION"
>PQresultErrorMessage</TT
>
(sobre el resultado). Sin embargo, un PGresult mantendrá su mensaje de error 
hasta que sea destruido, mientras que el mensaje de error de la conexión cambiará
cuando se realicen subsiguientes operaciones. Utilice 
<TT
CLASS="FUNCTION"
>PQresultErrorMessage</TT
> cuando quiera conocer la situación asociada
a un PGresult particular; utilice <TT
CLASS="FUNCTION"
>PQerrorMessage</TT
> cuando quiera
conocer la situación de la última operación en la conexión.</P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQntuples</TT
>
          Devuelve el númerod de tuplas (instancias) del resultado de la consulta.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>int PQntuples(const PGresult *res);</PRE
></TD
></TR
></TABLE
></P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQnfields</TT
>
          Devuelve el número de campos (atributos) de cada tupla del resultado
          de la consulta.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>int PQnfields(const PGresult *res);</PRE
></TD
></TR
></TABLE
></P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQbinaryTuples</TT
>
          Devuelve 1 si PGresult contiene datos binarios en las tuplas, y
          0 si contiene datos ASCII.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>int PQbinaryTuples(const PGresult *res);</PRE
></TD
></TR
></TABLE
>
Actualmente, los datos binarios de las tuplas solo los puede recuperar una consulta
que extraiga datos de un cursor <SPAN
CLASS="ACRONYM"
>BINARY</SPAN
>.</P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQfname</TT
>
 Devuelve el nombre del campo (atributo) asociado con el indice de campo dado.
 Los índices de campo empiezan con 0.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>char *PQfname(const PGresult *res,
                    int field_index);</PRE
></TD
></TR
></TABLE
></P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQfnumber</TT
>
 Devuelve el índice del campo (atributo) asociado con el nombre del campo dado.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>int PQfnumber(const PGresult *res,
              const char *field_name);</PRE
></TD
></TR
></TABLE
></P
><P
>        Se devuelve -1 si el nombre de campo dado no se corresponde con ningún campo.</P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQftype</TT
>
          Devuelve el tipo de campo asociado con el índice del campo dado. El 
          entero devuelto es una codificación interna del tipo. Los índices de
          campo empiezan con 0.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>Oid PQftype(const PGresult *res,
            int field_num);</PRE
></TD
></TR
></TABLE
>
Puede usted consultar la tabla de sistema <TT
CLASS="LITERAL"
>pg_type</TT
> para obtener
el nombre y propiedades de los diferentes tipos de datos. 
Los <SPAN
CLASS="ACRONYM"
>OID</SPAN
>,s de los tipos de datos incluidos por defecto están
definidos en <TT
CLASS="FILENAME"
>src/include/catalog/pg_type.h</TT
>, en el árbol de
fuentes del producto.</P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQfsize</TT
>
        Devuelve el tamaño en bytes del campo asociado con el índice de campo dado.
        Los índices de campo empiezan con 0.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>int PQfsize(const PGresult *res,
            int field_index);</PRE
></TD
></TR
></TABLE
>
        Qfsize devuelve el espacio reservado para este campo en una tupla de base
        de datos, en otras palabras, el tamaño de la representación binaria del
        tipo de datos en el servidor. Se devuelve -1 si el campo es de tamaño
        variable.</P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQfmod</TT
>
          Devuelve los datos de la modificación específica del tipo del campo
          asociado con el índice del campo dado.
          Los índices de campo empiezan en 0.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>int PQfmod(const PGresult *res,
           int field_index);</PRE
></TD
></TR
></TABLE
></P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQgetvalue</TT
>
          Devuelve un valor de un único campo (atributo) de una tupla de PGresult.
          Los índices de tuplas y de campos empiezan con 0.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>char* PQgetvalue(const PGresult *res,
                 int tup_num,
                 int field_num);</PRE
></TD
></TR
></TABLE
>
Para la mayoría de las consultas, el valor devuelto por <TT
CLASS="FUNCTION"
>PQgetvalue</TT
>
es una cadena <SPAN
CLASS="ACRONYM"
>ASCII</SPAN
> terminada en un valor NULL
que representa el valor del atributo. Pero si el valor de <TT
CLASS="FUNCTION"
>PQbinaryTuples()</TT
>
es 1, es valor que devuelve <TT
CLASS="FUNCTION"
>PQgetvalue</TT
> es la representación
binaria del tipo en el formato interno del servidor (pero no incluye la palabra del tamaño,
si el campo es de longitud variable). Es entonces responsabilidad del programador 
interpretar y convertir los datos en el tipo C correcto. El puntero devuelto por
<TT
CLASS="FUNCTION"
>PQgetvalue</TT
> apunta a una zona de almacenaje que forma parte de 
la estructura PGresult. No se la debería modificar, sino que se debería copiar explicitamente
el valor a otra estructura de almacenamiento si se pretende utilizar una vez
pasado el tiempo de vida de la estructura PGresult misma.</P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQgetlength</TT
>
          Devuelve la longitud de un campo (atributo) en bytes.
          Los índices de tupla y de campo empiezan en 0.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>int PQgetlength(const PGresult *res,
                int tup_num,
                int field_num);</PRE
></TD
></TR
></TABLE
>
Esta es la longitud de los datos actuales para el valor de datos particular, es decir, el 
tamaño del objeto apuntado por PQgetvalue. Notese que para valores representados en 
ASCII, este tamaño tiene poco que ver con el tamaño binario indicado por PQfsize.</P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQgetisnull</TT
>
           Prueba un campo por si tiene un valor NULL.
           Los índices de tupla y de campo empiezan con 0.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>int PQgetisnull(const PGresult *res,
                int tup_num,
                int field_num);</PRE
></TD
></TR
></TABLE
>
            Esta función devuelve 1 si el campo contiene un NULL, o 0 si
            contiene un valor no nulo.(Tenga en cuenta que PQgetvalue devolverá
            una cadena vacía, no un puntero nulo, para un campo NULL).</P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQcmdStatus</TT
>
        Devuelve la cadena de la situación del comando para el comando SQL que 
        generó el PGresult.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>char * PQcmdStatus(const PGresult *res);</PRE
></TD
></TR
></TABLE
></P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQcmdTuples</TT
>
        Devuelve el número de filas afectadas por el comando SQL.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>char * PQcmdTuples(const PGresult *res);</PRE
></TD
></TR
></TABLE
>
        Si el comando <SPAN
CLASS="ACRONYM"
>SQL</SPAN
> que generó el PGresult
        era INSERT, UPDATE o DELETE, devolverá una cadena que contiene
        el número de filas afectadas. Si el comando era cualquier otro, 
        devolverá una cadena vacía.</P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQoidValue</TT
>
          Devuelve el identificador de objeto (oid) de la tupla insertada,
          si el comando <SPAN
CLASS="ACRONYM"
>SQL</SPAN
> era una INSERT. En caso 
          contrario, devuelve <TT
CLASS="LITERAL"
>InvalidOid</TT
>.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>Oid PQoidValue(const PGresult *res);</PRE
></TD
></TR
></TABLE
>
          Tanto el tipo <SPAN
CLASS="TYPE"
>Oid</SPAN
> como la constante <TT
CLASS="LITERAL"
>Invalid</TT
>
          se definirán cuando incluya usted el fichero de cabeceras
          <TT
CLASS="APPLICATION"
>libpq</TT
>. Ambos serán de tipo entero (integer).</P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQoidStatus</TT
>
          Devuelve una cadena con el identificador de objeto de la tupla insertada
          si el comando <SPAN
CLASS="ACRONYM"
>SQL</SPAN
> era una INSERT. En otro caso devuelve
          una cadena vacía.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>char * PQoidStatus(const PGresult *res);</PRE
></TD
></TR
></TABLE
>
Esta función se ha despreciado en favor de <TT
CLASS="FUNCTION"
>PQoidValue</TT
>
y no asegura la hebra.</P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQprint</TT
>
          Imprime todas las tuplas y, opcionalmente, los nombres de los atributos
          en la salida especificada.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>void PQprint(FILE* fout,      /* output stream */
             const PGresult *res,
             const PQprintOpt *po);

struct {
    pqbool  header;      /* Imprime las cabeceras de los campos de salida 
                            y el contador de filas. */
    pqbool  align;       /* Fija la alineación de los campos. */
    pqbool  standard;    /* old brain dead format */
    pqbool  html3;       /* tabula la salida en html */
    pqbool  expanded;    /* expande las tablas */
    pqbool  pager;       /* Usa el paginador para la salida si se necesita. */
    char    *fieldSep;   /* separador de campos */
    char    *tableOpt;   /* lo inserta en &#60;tabla ...&#62; de HTML */
    char    *caption;    /* HTML &#60;caption&#62; */
    char    **fieldName; /* cadena terminada en null de nombres de campo alternativos. */
} PQprintOpt;</PRE
></TD
></TR
></TABLE
>
<TT
CLASS="APPLICATION"
>psql</TT
> utilizaba anteriormente esta función para
imprimir los resultados de las consultas, pero este ya no es el caso, y esta
función ya no se soporta activamente.</P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQclear</TT
>
          Libera la zona de almacenamiento asociada con PGresult. Todas los
          resultados de las consultas deberían liberarse con PQclear cuando ya no
          son necesarios.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>void PQclear(PQresult *res);</PRE
></TD
></TR
></TABLE
>
          Puede usted conserar un objeto PGresult tanto tiempo como lo necesite;
          no se conservará si realiza una nueva consulta, e incluso si se pierde la
          conexión. Para evitar esto, debe usted llamar a <TT
CLASS="FUNCTION"
>PQclear</TT
>.
          No hacerlo, repercute en pérdidas de memoria en la aplicación cliente.</P
></LI
><LI
><P
><TT
CLASS="FUNCTION"
>PQmakeEmptyPGresult</TT
>
          Construye un objeto PGresult vacío con la situación que se propone.
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>PGresult* PQmakeEmptyPGresult(PGconn *conn, ExecStatusType status);</PRE
></TD
></TR
></TABLE
>
Esta es una rutina interna de libpq para reservar e inicializar un objeto
PGresult vacío. Está exportada porque algunas aplicaciones consideran interesante
generar objetos resultado (particularmente objetos con situaciones de error) por
si mismas. Si conn no es NULL y status indica un error, el mensaje de error
(errorMessage) de la conexión en curso se copia en el PGresult. Recuerde que 
debería llamar a PQclear para este objeto también, del mismo modo que para 
un PGresult devuelto por la libpq misma.</P
></LI
></UL
></P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="libpq-chapter.html"
>Anterior</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="postgres.html"
>Inicio</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x20284.html"
>Siguiente</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>libpq</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="libpq-chapter.html"
>Subir</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Procesamiento Asíncrono de Consultas</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>