<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><head><title>
Manual de Allegro: 03 Rutinas de ratón
</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css">
<!--
A.xref:link    {color: blue; text-decoration: none; background: rgb(255, 204, 50);}
A.xref:visited {color: blue; text-decoration: none; background: rgb(255, 204, 50);}
A.xref:hover   {color: blue; text-decoration: underline; background: rgb(255, 224, 150);}
A.xref:active  {color: red; text-decoration: none; background: rgb(255, 204, 50);}
blockquote.xref {border: medium solid rgb(255, 204, 51); color: black; background: rgb(255, 204, 50);}
blockquote.code {border: medium solid rgb(255, 204, 50); color: black; background: rgb(255, 255, 155);}
blockquote.text {border: medium solid rgb(175, 235, 255); color: black; background: rgb(210, 244, 255);}
-->
</style>
</head><body bgcolor=white text=black link="#0000ee" alink="#ff0000" vlink="#551a8b">
<h1><a name="03 Rutinas de ratón">03 Rutinas de ratón</a></h1>

<ul>
<li><a href="#freeze_mouse_flag">freeze_mouse_flag</a>
<li><a href="#get_mouse_mickeys">get_mouse_mickeys</a>
<li><a href="#install_mouse">install_mouse</a>
<li><a href="#mouse_b">mouse_b</a>
<li><a href="#mouse_callback">mouse_callback</a>
<li><a href="#mouse_needs_poll">mouse_needs_poll</a>
<li><a href="#mouse_pos">mouse_pos</a>
<li><a href="#mouse_sprite">mouse_sprite</a>
<li><a href="#mouse_x">mouse_x</a>
<li><a href="#mouse_x_focus">mouse_x_focus</a>
<li><a href="#mouse_y">mouse_y</a>
<li><a href="#mouse_y_focus">mouse_y_focus</a>
<li><a href="#poll_mouse">poll_mouse</a>
<li><a href="#position_mouse">position_mouse</a>
<li><a href="#position_mouse_z">position_mouse_z</a>
<li><a href="#remove_mouse">remove_mouse</a>
<li><a href="#scare_mouse">scare_mouse</a>
<li><a href="#scare_mouse_area">scare_mouse_area</a>
<li><a href="#set_mouse_range">set_mouse_range</a>
<li><a href="#set_mouse_speed">set_mouse_speed</a>
<li><a href="#set_mouse_sprite">set_mouse_sprite</a>
<li><a href="#set_mouse_sprite_focus">set_mouse_sprite_focus</a>
<li><a href="#show_mouse">show_mouse</a>
<li><a href="#unscare_mouse">unscare_mouse</a>
</ul>

<p><br>
<b>int <a name="install_mouse">install_mouse</a>();</b><br>
   Instala el controlador del ratón de Allegro. Debe hacer esto antes de
   usar cualquier otra función del ratón. Devuelve -1 si hubo error (ej. si
   el controlador int33 no está cargado), o el número de botones del ratón.


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#position_mouse">position_mouse</a>,
<a class="xref" href="#set_mouse_range">set_mouse_range</a>,
<a class="xref" href="#set_mouse_speed">set_mouse_speed</a>,
<a class="xref" href="#remove_mouse">remove_mouse</a>,
<a class="xref" href="#poll_mouse">poll_mouse</a>,
<a class="xref" href="#mouse_x">mouse_x</a>,
<a class="xref" href="#show_mouse">show_mouse</a>,
<a class="xref" href="#get_mouse_mickeys">get_mouse_mickeys</a>,
<a class="xref" href="alleg002.html#Variables de configuración estándar">Variables de configuración estándar</a>.</font></blockquote>
<b>void <a name="remove_mouse">remove_mouse</a>();</b><br>
   Quita el controlador de ratón. Normalmente no necesita llamar esta
   función, porque allegro_exit() lo hará por usted.


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#install_mouse">install_mouse</a>,
<a class="xref" href="alleg000.html#allegro_exit">allegro_exit</a>.</font></blockquote>
<b>int <a name="poll_mouse">poll_mouse</a>();</b><br>
   Siempre que sea posible, Allegro leerá la entrada del ratón asíncronamente
   (ej: dentro de una interrupción), pero en algunas plataformas esto puede
   no ser posible, en cuyo caso debe llamar a esta rutina en intervalos
   regulares para actualizar las variables de estado del ratón. Para ayudarle
   a comprobar que su código de muestreo del ratón funciona incluso en una
   plataforma que no lo necesita, tras la primera llamada a esta rutina,
   Allegro entrará en modo muestreo, por lo que desde entonces en adelante
   deberá llamar manualmente a esta función para obtener cualquier dato del
   ratón, sin importar si el controlador actual necesita ser muestreado o nó.
   Devuelve cero con éxito, o un número negativo si hubo un fallo (ej: no hay
   driver de ratón instalado).


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#mouse_needs_poll">mouse_needs_poll</a>,
<a class="xref" href="#install_mouse">install_mouse</a>,
<a class="xref" href="#mouse_x">mouse_x</a>.</font></blockquote>
<b>int <a name="mouse_needs_poll">mouse_needs_poll</a>();</b><br>
   Devuelve TRUE si el controlador de ratón actual está siendo operado en
   modo muestreo.


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#poll_mouse">poll_mouse</a>,
<a class="xref" href="#install_mouse">install_mouse</a>,
<a class="xref" href="#mouse_x">mouse_x</a>.</font></blockquote>
<b>extern volatile int <a name="mouse_x">mouse_x</a>;</b><br>
<b>extern volatile int <a name="mouse_y">mouse_y</a>;</b><br>
<b>extern volatile int <a name="mouse_b">mouse_b</a>;</b><br>
<b>extern volatile int <a name="mouse_pos">mouse_pos</a>;</b><br>
   Variables globales que contienen la posición actual del ratón y el estado
   de los botones. Las posiciones mouse_x y mouse_y son enteros que van de
   cero a la esquina inferior derecha de la pantalla. La variable mouse_b es
   un campo de bits indicando el estado de cada botón: bit 0 es el botón
   izquierdo, bit 1 es del derecho, y bit 2 el botón central. Por ejemplo:
<blockquote class="code"><pre>
      if (mouse_b &amp; 1)
         printf("El botón izquierdo está pulsado\n");

      if (!(mouse_b &amp; 2))
         printf("El botón derecho no está pulsado\n");
</pre></blockquote>
   La variable pouse_pos contiene la coordenada X actual en la palabra alta
   y la coordenada Y en la palabra baja. Esto es útil en bucles rápidos de
   lectura donde una interrupción del ratón podría ocurrir mientras lee las
   dos variables por separado, ya que puede copiar este valor a una variable
   local con una instrucción, y entonces separarlo con tranquilidad.


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#install_mouse">install_mouse</a>.</font></blockquote>
<b>extern BITMAP *<a name="mouse_sprite">mouse_sprite</a>;</b><br>
<b>extern int <a name="mouse_x_focus">mouse_x_focus</a>;</b><br>
<b>exterm int <a name="mouse_y_focus">mouse_y_focus</a>;</b><br>
   Variables globales que contienen el sprite actual del ratón y el punto
   del foco. Estas variables sólo son de lectura, y sólo se pueden
   modificar usando las funciones set_mouse_sprite() y
   set_mouse_sprite_focus().


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#set_mouse_sprite">set_mouse_sprite</a>,
<a class="xref" href="#set_mouse_sprite_focus">set_mouse_sprite_focus</a>.</font></blockquote>
<b>void <a name="show_mouse">show_mouse</a>(BITMAP *bmp);</b><br>
   Le dice a Allegro que muestre el puntero del ratón en la pantalla. Esto
   sólo funcionará si el módulo de temporización está instalado. El puntero
   del ratón será dibujado sobre el bitmap especificado, que será
   normalmente 'screen' (lee más abajo información sobre bitmaps). Para
   ocultar el puntero del ratón, llame show_mouse(NULL). Aviso: si dibuja
   algo en la pantalla mientras el puntero está visible, podría ocurrir una
   interrupción de movimiento en medio de su operación de dibujo. Si esto
   ocurre, el buffer del ratón y el código de cambio de banco SVGA se
   confundirán, y dejarán 'rastros de ratón' por toda la pantalla. Para
   evitar esto, debe asegurarse que oculta el puntero del ratón siempre que
   vaya a dibujar la pantalla.


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#freeze_mouse_flag">freeze_mouse_flag</a>,
<a class="xref" href="#install_mouse">install_mouse</a>,
<a class="xref" href="alleg004.html#install_timer">install_timer</a>,
<a class="xref" href="#set_mouse_sprite">set_mouse_sprite</a>,
<a class="xref" href="#scare_mouse">scare_mouse</a>.</font></blockquote>
<b>void <a name="scare_mouse">scare_mouse</a>();</b><br>
   Función de ayuda para ocultar el puntero del ratón antes de una operación
   de dibujado. Esto se deshará temporalmente del puntero del ratón, pero
   sólo si es realmente necesario (ej. el ratón es visible, y está siendo
   visualizado en la pantalla física, y no se trata de un cursor por
   hardware). El estado previo del ratón es almacenado para las llamadas
   siguientes a unscare_mouse().


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#unscare_mouse">unscare_mouse</a>,
<a class="xref" href="#show_mouse">show_mouse</a>.</font></blockquote>
<b>void <a name="scare_mouse_area">scare_mouse_area</a>(int x, int y, int w, int h);</b><br>
   Como scare_mouse(), pero sólo ocultará el cursor si éste se encuentra
   dentro del rectángulo especificado. Si no lo está, el cursor simplemente
   será congelado hasta que llame a unscare_mouse(), para que no pueda
   interferir con su dibujado.


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#unscare_mouse">unscare_mouse</a>,
<a class="xref" href="#scare_mouse_area">scare_mouse_area</a>,
<a class="xref" href="#show_mouse">show_mouse</a>.</font></blockquote>
<b>void <a name="unscare_mouse">unscare_mouse</a>();</b><br>
   Deshace el efecto de una llamada previa a scare_mouse(), recuperando el
   estado original del puntero.


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#scare_mouse">scare_mouse</a>.</font></blockquote>
<b>extern int <a name="freeze_mouse_flag">freeze_mouse_flag</a>;</b><br>
   Si esta variable está activa, el puntero del ratón no será redibujado
   cuando mueva el ratón. Esto le puede evitar tener que ocultar el puntero
   cada vez que dibuje en la pantalla, siempre que no dibuje sobre la
   posición actual del puntero.


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#show_mouse">show_mouse</a>.</font></blockquote>
<b>void <a name="position_mouse">position_mouse</a>(int x, int y);</b><br>
   Mueve el ratón a la posición de pantalla especificada. Puede llamar esta
   función incluso mientras el puntero esté visible.


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#install_mouse">install_mouse</a>,
<a class="xref" href="#set_mouse_range">set_mouse_range</a>,
<a class="xref" href="#set_mouse_speed">set_mouse_speed</a>.</font></blockquote>
<b>void <a name="position_mouse_z">position_mouse_z</a>(int z);</b><br>
   Establece la variable que contiene la posición de la ruedecilla del ratón
   al valor indicado.


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#install_mouse">install_mouse</a>,
<a class="xref" href="#position_mouse">position_mouse</a>.</font></blockquote>
<b>void <a name="set_mouse_range">set_mouse_range</a>(int x1, int y1, int x2, int y2);</b><br>
   Crea un área de pantalla sobre la que el ratón se podrá desplazar. Pase
   los parámetros de las esquinas del recuadro (coordenadas inclusivas). Si
   no llama esta función, el área por defecto se activará a (0, 0,
   SCREEN_W-1, SCREEN_H-1).


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#install_mouse">install_mouse</a>,
<a class="xref" href="#set_mouse_speed">set_mouse_speed</a>,
<a class="xref" href="#position_mouse">position_mouse</a>.</font></blockquote>
<b>void <a name="set_mouse_speed">set_mouse_speed</a>(int xspeed, int yspeed);</b><br>
   Ajusta la velocidad del ratón. Valores grandes de xspeed e yspeed
   significan un movimiento más lento: por defecto ambos son 2.


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#install_mouse">install_mouse</a>,
<a class="xref" href="#set_mouse_range">set_mouse_range</a>,
<a class="xref" href="#position_mouse">position_mouse</a>.</font></blockquote>
<b>void <a name="set_mouse_sprite">set_mouse_sprite</a>(BITMAP *sprite);</b><br>
   ¿No le gusta mi puntero de ratón? No problemo. Use esta función para usar
   uno propio alternativo. Si cambia el puntero y luego quiere volver a
   ver mi querida flecha otra vez, llame set_mouse_sprite(NULL).

<p>
   Como bonificación, set_mouse_sprite(NULL) usa la paleta de colores
   actualmente seleccionada para elegir los colores de la flecha. Por lo que
   si el cursor se ve feo tras cambiar la paleta, llame a
   set_mouse_sprite(NULL).


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#install_mouse">install_mouse</a>,
<a class="xref" href="#show_mouse">show_mouse</a>,
<a class="xref" href="#set_mouse_sprite_focus">set_mouse_sprite_focus</a>.</font></blockquote>
<b>void <a name="set_mouse_sprite_focus">set_mouse_sprite_focus</a>(int x, int y);</b><br>
   El foco del ratón es la parte del puntero que representa la posición
   actual del ratón, vamos, la posición (mouse_x, mouse_y). Por defecto el
   foco está arriba a la izquierda de la flecha, pero si va a usar un
   puntero de ratón diferente, quizás deba alterar esto.


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#set_mouse_sprite">set_mouse_sprite</a>.</font></blockquote>
<b>void <a name="get_mouse_mickeys">get_mouse_mickeys</a>(int *mickeyx, int *mickeyy);</b><br>
   Mide cómo de lejos se ha movido el ratón desde la última llamada a esta
   función. El ratón seguirá generando unidades de movimiento incluso cuando
   llegue al borde de la pantalla, por lo que esta forma de control puede
   ser útil en juegos que requieran un rango de movimiento del ratón
   infinito.


<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#install_mouse">install_mouse</a>.</font></blockquote>
<b>extern void (*<a name="mouse_callback">mouse_callback</a>)(int flags);</b><br>
   Llamado por el controlador de interrupciones siempre cuando el ratón se
   mueva o el valor de los botones cambie. Esta función debe ser bloqueada en
   memoria (locked), y debe ejecutarse ¡muy rápido! Se le pasan los
   bits de evento que activaron la llamada, que son una máscara de bits
   que puede contener cualquiera de los siguientes valores MOUSE_FLAG_MOVE,
   MOUSE_FLAG_LEFT_DOWN, MOUSE_FLAG_LEFT_UP, MOUSE_FLAG_RIGHT_DOWN,
   MOUSE_FLAG_RIGHT_UP, MOUSE_FLAG_MIDDLE_DOWN, MOUSE_FLAG_MIDDLE_UP, y
   MOUSE_FLAG_MOVE_Z.




<blockquote class="xref"><font size="-1" face="helvetica,verdana"><em><b>Relacionado con:</b></em>
<a class="xref" href="#install_mouse">install_mouse</a>.</font></blockquote>
<hr><a href="allegro.html">Volver al Indice</a>

</body>
</html>
