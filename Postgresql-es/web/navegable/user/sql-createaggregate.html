<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<HTML
><HEAD
><TITLE
>   CREATE AGGREGATE
  </TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.59"><LINK
REL="HOME"
TITLE="Manual del usuario de PostgreSQL"
HREF="user.html"><LINK
REL="UP"
TITLE="Instrucciones SQL"
HREF="sql-commands.html"><LINK
REL="PREVIOUS"
TITLE="   COPY
  "
HREF="sql-copy.html"><LINK
REL="NEXT"
TITLE="   CREATE DATABASE
  "
HREF="sql-createdatabase.html"></HEAD
><BODY
CLASS="REFENTRY"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Manual del usuario de PostgreSQL</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sql-copy.html"
>Anterior</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="sql-createdatabase.html"
>Siguiente</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="SQL-CREATEAGGREGATE"
>CREATE AGGREGATE</A
></H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN4821"
></A
><H2
>Nombre</H2
>   CREATE AGGREGATE
  &nbsp;--&nbsp;   Define una nueva función de agregado
  </DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN4824"
></A
><H2
>Synopsis</H2
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SYNOPSIS"
>CREATE AGGREGATE <TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
> [ AS ] ( BASETYPE = <TT
CLASS="REPLACEABLE"
><I
>data_type</I
></TT
>
    [ , SFUNC1 = <TT
CLASS="REPLACEABLE"
><I
>sfunc1</I
></TT
>, STYPE1 = <TT
CLASS="REPLACEABLE"
><I
>sfunc1_return_type</I
></TT
> ]
    [ , SFUNC2 = <TT
CLASS="REPLACEABLE"
><I
>sfunc2</I
></TT
>, STYPE2 = <TT
CLASS="REPLACEABLE"
><I
>sfunc2_return_type</I
></TT
> ]
    [ , FINALFUNC = <TT
CLASS="REPLACEABLE"
><I
>ffunc</I
></TT
> ]
    [ , INITCOND1 = <TT
CLASS="REPLACEABLE"
><I
>initial_condition1</I
></TT
> ]
    [ , INITCOND2 = <TT
CLASS="REPLACEABLE"
><I
>initial_condition2</I
></TT
> ] )
  </PRE
></TD
></TR
></TABLE
><DIV
CLASS="REFSECT2"
><A
NAME="R2-SQL-CREATEAGGREGATE-1"
></A
><H3
>    Entradas
   </H3
><P
>    <P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="REPLACEABLE"
><I
>name</I
></TT
></DT
><DD
><P
>        El nombre de la función de agregado a crear.
       </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>data_type</I
></TT
></DT
><DD
><P
>        El tipo de dato fundamental sobre el que opera esta función de agregado.
       </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>sfunc1</I
></TT
></DT
><DD
><P
>        La función de estado de trancisión que ha de llamarse para cada campo no nulo desde la 
        columna fuente. Toma una variable del tipo <TT
CLASS="REPLACEABLE"
><I
>sfunc1_return_type</I
></TT
> 
        como primer argumento y el campo como segundo argumento.
       </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>sfunc1_return_type</I
></TT
></DT
><DD
><P
>        El tipo devuelto de la primera función de trancisión.
       </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>sfunc2</I
></TT
></DT
><DD
><P
>	La función de estado de trancisión que ha de llamarse para cada campo no nulo de la 
        columna origen. Toma una variable de tipo <TT
CLASS="REPLACEABLE"
><I
>sfunc2_return_type</I
></TT
> 
        como argumento unico y devuelve una variable del mismo tipo.
       </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>sfunc2_return_type</I
></TT
></DT
><DD
><P
>        EL tipo devuelto por la segunda función de trancisión.
       </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>ffunc</I
></TT
></DT
><DD
><P
>        La función final llamada tras convertir todos los campos de entrada. Esta función 
        debe recibir dos argumentos de los tipos 
        <TT
CLASS="REPLACEABLE"
><I
>sfunc1_return_type</I
></TT
> y 
        <TT
CLASS="REPLACEABLE"
><I
>sfunc2_return_type</I
></TT
>.
       </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>initial_condition1</I
></TT
></DT
><DD
><P
>        El valor inicial para el argumento de la primera función de trancisión.
       </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>initial_condition2</I
></TT
></DT
><DD
><P
>        El valor inicial del argumento de la segunda función de trancisión.
       </P
></DD
></DL
></DIV
>
   </P
></DIV
><DIV
CLASS="REFSECT2"
><A
NAME="R2-SQL-CREATEAGGREGATE-2"
></A
><H3
>    Outputs
   </H3
><P
>&#13;    <P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="COMPUTEROUTPUT"
>CREATE
       </TT
></DT
><DD
><P
>        Mensaje devuelto si el comando se completa satifactoriamente.
       </P
></DD
></DL
></DIV
>
   </P
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="R1-SQL-CREATEAGGREGATE-1"
></A
><H2
>   Description
  </H2
><P
>   <B
CLASS="COMMAND"
>CREATE AGGREGATE</B
> 
   permite a un usuario o programador extender la funcionalidad de <SPAN
CLASS="PRODUCTNAME"
>Postgres</SPAN
> 
   definiendo nuevas funciones de agregado. Algunas funciones de agregado para tipos base como 
   <TT
CLASS="FUNCTION"
>min(int4)</TT
> y <TT
CLASS="FUNCTION"
>avg(float8)</TT
> están ya disponibles en la 
   distribución base. Si se definen nuevos tipos o se necesita una función de agregado que no 
   se proporciona, puede usarse el comando <B
CLASS="COMMAND"
>CREATE AGGREGATE</B
> para proporcionar 
   las características deseadas.
  </P
><P
>   Una función de agregados puede requerir hasta tres funciones, dos funciones de trancisión de 
   estado, <TT
CLASS="REPLACEABLE"
><I
>sfunc1</I
></TT
> y <TT
CLASS="REPLACEABLE"
><I
>sfunc2</I
></TT
>:
   <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
><TT
CLASS="REPLACEABLE"
><I
>sfunc1</I
></TT
>( internal-state1, next-data_item ) ---&#62; next-internal-state1 <TT
CLASS="REPLACEABLE"
><I
>sfunc2</I
></TT
>( internal-state2 ) ---&#62; next-internal-state2
   </PRE
></TD
></TR
></TABLE
>
   y una función final de cálculo,
   <TT
CLASS="REPLACEABLE"
><I
>ffunc</I
></TT
>:
   <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
><TT
CLASS="REPLACEABLE"
><I
>ffunc</I
></TT
>(internal-state1, internal-state2) ---&#62; aggregate-value
   </PRE
></TD
></TR
></TABLE
>
  </P
><P
>   <SPAN
CLASS="PRODUCTNAME"
>Postgres</SPAN
> crea hasta dos variables temporales (referidas aquí como 
   <TT
CLASS="REPLACEABLE"
><I
>temp1</I
></TT
> y <TT
CLASS="REPLACEABLE"
><I
>temp2</I
></TT
>) 
   para mantener resultados intermadios usados como argumentos por las funciones de trancisión.
  </P
><P
>   Estas funciones de trancisión han de tener las siguinetes propiedades:
   <P
></P
><UL
><LI
><P
>      Los argumentos de <TT
CLASS="REPLACEABLE"
><I
>sfunc1</I
></TT
> deben ser 
      <TT
CLASS="REPLACEABLE"
><I
>temp1</I
></TT
> del tipo 
      <TT
CLASS="REPLACEABLE"
><I
>sfunc1_return_type</I
></TT
> y 
      <TT
CLASS="REPLACEABLE"
><I
>column_value</I
></TT
> de tipo 
      <TT
CLASS="REPLACEABLE"
><I
>data_type</I
></TT
>.
      El valor devuelto debe ser del tipo <TT
CLASS="REPLACEABLE"
><I
>sfunc1_return_type</I
></TT
> 
      y será usado como primer argumento en la proxima llamada a <TT
CLASS="REPLACEABLE"
><I
>sfunc1</I
></TT
>. 
     </P
></LI
><LI
><P
>      El argumento y valor devuelto de <TT
CLASS="REPLACEABLE"
><I
>sfunc2</I
></TT
> ha de 
      ser <TT
CLASS="REPLACEABLE"
><I
>temp2</I
></TT
> del tipo 
      <TT
CLASS="REPLACEABLE"
><I
>sfunc2_return_type</I
></TT
>.
     </P
></LI
><LI
><P
>      Los argumento para la función de cálculo final  ha de ser <TT
CLASS="REPLACEABLE"
><I
>temp1</I
></TT
> 
      y <TT
CLASS="REPLACEABLE"
><I
>temp2</I
></TT
> y su valor devuelto debe ser un tipo 
      base de <SPAN
CLASS="PRODUCTNAME"
>Postgres</SPAN
> (no necesariamente <TT
CLASS="REPLACEABLE"
><I
>data_type</I
></TT
> 
      que ha sido especificado por BASETYPE).
     </P
></LI
><LI
><P
>	
      FINALFUNC debe ser especificado si y solo si ambas funciones de trancisión de estado son 
      especificadas.
     </P
></LI
></UL
>
  </P
><P
>	
   Una función de agregado puede requerir solo una o dos condiciones iniciales, una para cada 
   función de trancisión. Estas se especifican y almacenan en la base de datos como campos de 
   tipo <SPAN
CLASS="TYPE"
>text</SPAN
>.
  </P
><DIV
CLASS="REFSECT2"
><A
NAME="R2-SQL-CREATEAGGREGATE-3"
></A
><H3
>    Notes
   </H3
><P
>    Use <B
CLASS="COMMAND"
>DROP AGGREGATE</B
> para desechar funciones de agregado.
   </P
><P
>    Es posible especificar funciones de agregado que tengan diversas convinaciones de funciones 
    de estado y funciones finales. Por ejemplo, la función de agregado <TT
CLASS="FUNCTION"
>count</TT
> 
    requiere SFUNC2 (una función de incremento) pero no SFUNC1 o FINALFUNC, mientras que la 
    función de agregado <TT
CLASS="FUNCTION"
>sum</TT
> requiere SFUNC1 (una función de adicción) pero 
    no SFUNC2 ni FINALFUNC y la función de agregado <TT
CLASS="FUNCTION"
>avg</TT
> requiere tanto las 
    dos funciones de estado como una FINALFUNC (una función de división) para producir su 
    resultado. En cualquier caso, al menos una de las funciones de estado debe ser definida, y 
    cualquier SFUNC2 debe tener el correspondiente INITCOND2.
   </P
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="R1-SQL-CREATEAGGREGATE-2"
></A
><H2
>   Usage
  </H2
><P
>   Vease el capítulo de las funciones de agregado en la Guia del Programador 
   (<I
CLASS="CITETITLE"
>PostgreSQL Programmer's Guide</I
>) para ejemplos de uso más completos.
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="R1-SQL-CREATEAGGREGATE-3"
></A
><H2
>   Compatibilidad
  </H2
><DIV
CLASS="REFSECT2"
><A
NAME="R2-SQL-CREATEAGGREGATE-4"
></A
><H3
>    SQL92
   </H3
><P
>    <B
CLASS="COMMAND"
>CREATE AGGREGATE</B
> es una extensión del lenguaje de <SPAN
CLASS="PRODUCTNAME"
>Postgres</SPAN
> 
    No existe la orden <B
CLASS="COMMAND"
>CREATE AGGREGATE</B
> en SQL92.
   </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sql-copy.html"
>Anterior</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="user.html"
>Inicio</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sql-createdatabase.html"
>Siguiente</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>COPY</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="sql-commands.html"
>Subir</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>CREATE DATABASE</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>